!function(e,o,f,h,m){e&&!h&&(h=require("underscore"));function i(){return{rootClass:"",formClass:"form-group",formReadonlyClass:"jsonform-readonly",formDisabledClass:"jsonform-disabled",formInlineClass:"form-inline",formsGroupClass:"form-group",groupMarkClassPrefix:"has-",labelClass:"col-form-label",controlClass:"",iconClassPrefix:"fa fa",buttonClass:"btn-secondary",submitButtonClass:"btn-primary",resetButtonClass:"btn-danger",buttonGroupClass:"btn-group",textualInputClass:"form-control",inputGroupClass:"input-group",prependClass:"input-group-prepend",appendClass:"input-group-append",addonClass:"input-group-text",placementClassPrefix:"float",helpClass:"form-text text-muted",useTooltip:!!f.fn.tooltip,tooltipClass:"",tooltipIconSuffix:"info-circle",actionsClass:"",errorTextClass:"text-danger",imgResponsiveClass:"img-fluid",legendClass:"col-form-label-lg",navTabsClass:"nav-tabs",navItemClass:"nav-item",navLinkClass:"nav-link",selectWrapClass:"",rangeInputClass:"form-control-range",switchWrapClass:"custom-control custom-switch",switchInputClass:"custom-control-input",switchLabelClass:"custom-control-label",radioWrapClass:"form-check",radioWrapInlineClass:"form-check form-check-inline",radioInputClass:"form-check-input",radioLabelClass:"form-check-label",checkboxWrapClass:"form-check",checkboxWrapInlineClass:"form-check form-check-inline",checkboxInputClass:"form-check-input",checkboxLabelClass:"form-check-label",dropdownMenuClass:"",dropdownInputClass:"",bootstrapValidation:!0}}function u(e){return!(h.isUndefined(e)||h.isNull(e))}function r(e,t){return"object"==typeof e&&e.hasOwnProperty(t)}function p(e){return u(e)&&(e=""+e)?e.replace(/&(?!\w+;|#\d+;|#x[\da-f]+;)/gi,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;"):""}function g(e){return e.replace(/([ \!\"\#\$\%\&\'\(\)\*\+\,\.\/\:\;<\=\>\?\@\[\\\]\^\`\{\|\}\~])/g,"\\$1")}function d(e){return e.replace(/\ /g,"_")}function v(){f('[data-toggle="tooltip"]').tooltip()}function l(e){function l(e,t){t.find("> .active").removeClass("active").find("> a.active").removeClass("active"),e.addClass("active").find("> a").addClass("active")}function a(e,t){e.find("input, textarea, select").prop("disabled",!1),e.parent().children(":not([data-idx="+t+"])").find("input, textarea, select").attr("disabled","disabled")}function t(e){var t=f("option:selected",f(this)),n=f(this),i=t.get(0).getAttribute("data-idx")||t.attr("value");e.preventDefault(),t.hasClass("active")||(e=f(this).parents(".jsonform-tabbable").eq(0).find("> .tab-content > [data-idx="+i+"]"),l(t,n),l(e,e.parent()),a(e,i))}function n(e){f("a",f(this));var t=f(this).parents(".jsonform-tabbable").first().find(".tab-content").first(),n=f(this).index(),t=t.find("> [data-idx="+n+"]");e.preventDefault(),l(f(this),f(this).parent()),l(t,t.parent()),f(this).parent().hasClass("jsonform-alternative")&&a(t,n)}e.each(function(){f(this).on("change","select.nav",t),f(this).find("select.nav").each(function(){f(this).val(f(this).find(".active").attr("value"));var e=f(this).find("option:selected").get(0).getAttribute("data-idx")||f(this).find("option:selected").attr("value"),t=f(this).parents(".jsonform-tabbable").eq(0).find("> .tab-content > [data-idx="+e+"]");a(t,e)}),f(this).on("click","ul.nav li",n),f(this).find("ul.nav li.active").trigger("click")})}function t(e,t,n){return e={template:'<input type="'+e+'" class="<%= fieldHtmlClass'+(t?" || cls.textualInputClass":"")+' %>" name="<%= node.name %>" value="<%= escape(value) %>" id="<%= id %>" aria-label="<%= node.title ? escape(node.title) : node.name %>"<%= (node.disabled? " disabled" : "")%><%= (node.isReadOnly() ? " readonly=\'readonly\'" : "") %><%= (node.schemaElement && node.schemaElement.minLength ? " minlength=\'" + node.schemaElement.minLength + "\'" : "") %><%= (node.schemaElement && node.schemaElement.maxLength ? " maxlength=\'" + node.schemaElement.maxLength + "\'" : "") %><%= (node.required ? " required=\'required\'" : "") %><%= (node.placeholder? " placeholder=" + \'"\' + escape(node.placeholder) + \'"\' : "")%><%= (node.schemaElement && node.schemaElement.pattern ? " pattern=\'" + node.schemaElement.pattern + "\'" : "") %> />',fieldtemplate:!0,inputfield:!0,onInsert:function(e,t){if(t.formElement){var n=f(t.el).find("input");if(t.formElement.autocomplete&&n.autocomplete&&n.autocomplete(t.formElement.autocomplete),t.formElement.tagsinput||"tagsvalue"===t.formElement.getValue){if(!f.fn.tagsinput)throw new Error("tagsinput is not found");var i=Array.isArray(t.value),l=(i&&n.attr("value","").val(""),{maxChars:t.schemaElement&&t.schemaElement.maxLength&&-1<t.schemaElement.maxLength?t.schemaElement.maxLength:void 0});t.formElement.tagsinput&&h.extend(l,t.formElement.tagsinput),n.tagsinput(l),i&&t.value.forEach(function(e){n.tagsinput("add",e)})}t.formElement.typeahead&&n.typeahead&&n.typeahead(t.formElement.typeahead)}}},e=n?h.extend(e,n):e}function n(i,e){return{template:("range"===i?'<div class="range">':"")+'<input type="'+i+'" class="<%= fieldHtmlClass'+(e?" || cls.textualInputClass":"")+" %>"+("range"===i?"<%= cls.rangeInputClass %>":"")+'" name="<%= node.name %>" value="<%= escape(value) %>" id="<%= id %>" aria-label="<%= node.title ? escape(node.title) : node.name %>"<%= (node.disabled? " disabled" : "")%><%= (node.isReadOnly() ? " readonly=\'readonly\'" : "") %><%= (range.min !== undefined ? " min="+range.min : "")%><%= (range.max !== undefined ? " max="+range.max : "")%><%= (range.step !== undefined ? " step="+range.step : "")%><%= (node.schemaElement && node.schemaElement.minLength ? " minlength=\'" + node.schemaElement.minLength + "\'" : "") %><%= (node.schemaElement && node.schemaElement.maxLength ? " maxlength=\'" + node.schemaElement.maxLength + "\'" : "") %><%= (node.required ? " required=\'required\'" : "") %><%= (node.placeholder? " placeholder=" + \'"\' + escape(node.placeholder) + \'"\' : "")%> />'+("range"===i?'<% if (range.indicator) { %><span class="range-value" rel="<%= id %>"><%= escape(value) %></span><% } %></div>':""),fieldtemplate:!0,inputfield:!0,onInput:function(e,t){const n=document.querySelector('span.range-value[rel="'+t.id+'"]');n&&(n.innerText=e.target.value)},onBeforeRender:function(e,t){var n;e.range={step:1,indicator:!1},"range"==i&&(e.range.min=1,e.range.max=100),t&&t.schemaElement&&(void 0!==t.schemaElement.multipleOf?e.range.step=t.schemaElement.multipleOf:t.formElement&&t.formElement.step?e.range.step=t.formElement.step:"number"==t.schemaElement.type&&(e.range.step="any"),n="any"===e.range.step?1:e.range.step,t.formElement&&t.formElement.indicator&&(e.range.indicator=t.formElement.indicator),void 0!==t.schemaElement.minimum&&(t.schemaElement.exclusiveMinimum?e.range.min=t.schemaElement.minimum+n:e.range.min=t.schemaElement.minimum),void 0!==t.schemaElement.maximum&&(t.schemaElement.exclusiveMaximum?e.range.max=t.schemaElement.maximum-n:e.range.max=t.schemaElement.maximum))}}}function c(e,t){if(t=t.replace(/\./g,".properties.").replace(/\[[0-9]*\]/g,".items"),(e=k.util.getObjKey(e,t,!0))&&e.$ref)throw new Error("JSONForm does not yet support schemas that use the $ref keyword. See: https://github.com/joshfire/jsonform/issues/54");return e}function y(e,t,n){var i;if(n=n||0,u(t)&&""!==t)if(e.default&&0==n)i=k.util.getObjKeyEx(e.default,t);else{var l=t.match(/^((([^\\\[.]|\\.)+)|\[(\d+)\])\.?(.*)$/);if(!l)throw new Error("bad format key: "+t);if("string"==typeof l[2]&&0<l[2].length)e=e.properties[l[2]];else{if(!("string"==typeof l[4]&&0<l[4].length))throw new Error("impossible reach here");e=e.items,0<n&&--n}e&&(i=e.default&&0==n?k.util.getObjKeyEx(e.default,l[5]):y(e,l[5],n))}else 0==n&&(i=e.default);return i}function b(e,n,i){var l=0;return e?n&&0!==n.length?e.replace(x,function(e,t){return i&&2!=e.length||!u(n[l])||(e="["+n[l]+"]"),l+=1,e}):e:null}function C(){this.id=null,this.key=null,this.el=null,this.formElement=null,this.schemaElement=null,this.view=null,this.children=[],this.ownerTree=null,this.parentNode=null,this.childTemplate=null,this.legendChild=null,this.arrayPath=[],this.childPos=0}function a(){this.eventhandlers=[],this.root=null,this.formDesc=null}var x=/\[([0-9]*)\](?=\[|\.|$)/g,w={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g},E={evaluate:/\{\[([\s\S]+?)\]\}/g,interpolate:/\{\{([\s\S]+?)\}\}/g},k={util:{}};k.fieldTemplate=function(e){return'<div <% for(var key in elt.htmlMetaData) {%><%= key %>="<%= elt.htmlMetaData[key] %>" <% }%>class="<%= cls.formClass %> jsonform-node jsonform-error-<%= keydash %><%= elt.htmlClass ? " " + elt.htmlClass : "" %><%= (node.required && node.formElement && (node.formElement.type !== "checkbox") && (node.formElement.type !== "switch") ? " jsonform-required" : "") %><%= (node.isReadOnly() ? " " + cls.formReadonlyClass : "") %><%= (node.disabled ? " " + cls.formDisabledClass : "") %>" data-jsonform-type="<%= node.formElement.type %>"><% if (!elt.notitle && node.inlinetitle !== true) { %><label class="<%= cls.labelClass %>" for="<%= node.id %>"><%= node.getTitle() %><% if (node.description && (elt.useTooltip === true || (elt.useTooltip === undefined && cls.useTooltip))) { %><span data-toggle="tooltip" data-placement="right" title="<%= node.description %>" class="<%= cls.tooltipClass %> jsonform-description-tooltip"><i class="<%= cls.iconClassPrefix %>-<%= cls.tooltipIconSuffix %>"></i></span><% } %></label><% } %><div<% if (cls.controlClass) { %> class="<%= cls.controlClass %>"<% } %>><% if (node.description && !(elt.useTooltip === true || (elt.useTooltip === undefined && cls.useTooltip))) { %><small class="<%= cls.helpClass %> jsonform-description"><%= node.description %></small><% } %><% if (node.prepend || node.append) { %><div class="<%= cls.inputGroupClass %>"><% if (node.prepend) { %><% if (cls.prependClass) { %><div class="<%= cls.prependClass %>"><% } %><% if (node.prepend.indexOf("<input ") >= 0) { %><div class="<%= cls.addonClass %>"><%= node.prepend %></div><% } else { %><% if (node.prepend.indexOf("<button ") >= 0) { %><%= node.prepend %><% } else { %><span class="<%= cls.addonClass %>"><%= node.prepend %></span><% } %><% } %><% if (cls.prependClass) { %></div><% } %><% } %>'+e+'<% if (node.append) { %><% if (cls.appendClass) { %><div class="<%= cls.appendClass %>"><% } %><% if (node.append.indexOf("<input ") >= 0) { %><div class="<%= cls.addonClass %>"><%= node.append %></div><% } else { %><% if (node.append.indexOf("<button ") >= 0) { %><%= node.append %><% } else { %><span class="<%= cls.addonClass %>"><%= node.append %></span><% } %><% } %><% if (cls.appendClass) { %></div><% } %><% } %></div><% } else { %>'+e+'<% } %><small class="<%= cls.errorTextClass %> jsonform-errortext" style="display:none;"></small></div></div>'},k.elementTypes={none:{template:""},root:{template:'<div<% if (cls.rootClass) { %> class="<%= cls.rootClass %>"<% } %>><%= children %></div>'},text:t("text",!0),password:t("password",!0),date:t("date",!0,{onInsert:function(e,t){var n,i;window.Modernizr&&window.Modernizr.inputtypes&&!window.Modernizr.inputtypes.date&&(n=f(t.el).find("input")).datepicker&&(i={dateFormat:"yy-mm-dd"},t.formElement&&t.formElement.datepicker&&"object"==typeof t.formElement.datepicker&&h.extend(i,t.formElement.datepicker),n.datepicker(i))}}),datetime:t("datetime",!0),"datetime-local":t("datetime-local",!0,{onBeforeRender:function(e,t){e.value&&e.value.getTime&&(e.value=new Date(e.value.getTime()-6e4*e.value.getTimezoneOffset()).toISOString().slice(0,-1))}}),email:t("email",!0),month:t("month",!0),number:n("number",!0),search:t("search",!0),tel:t("tel",!0),time:t("time",!0),url:t("url",!0),week:t("week",!0),range:n("range"),color:{template:'<span id="color_picker_<%= id %>"><input type="text" <%= (fieldHtmlClass ? "class=\'" + fieldHtmlClass + "\' " : "") %>name="<%= node.name %>" value="<%= escape(value) %>" id="<%= id %>" aria-label="<%= node.title ? escape(node.title) : node.name %>"<%= (node.disabled? " disabled" : "")%><%= (node.required ? " required=\'required\'" : "") %><%= (node.isReadOnly()? " readonly=\'readonly\'" : "") %> /></span>',fieldtemplate:!0,inputfield:!0,getElement:function(e){return f(e).parent().get(0)},onInsert:function(e,t){var n;o.Picker?(f(t.el).find("input").attr("readOnly","true"),(n=f(t.el).find("input").attr("value"))&&f(t.el).find("#"+g(t.id)).attr("style","background-color:"+n+";color:"+n),new o.Picker({parent:document.querySelector("#color_picker_"+g(t.id)),alpha:!1,color:n||"",editor:!0,editorFormat:"hex",cancelButton:!0,onDone:function(e){f(t.el).find("#"+g(t.id)).attr("value",e.hex.slice(0,7)).attr("style","background-color:"+e.hex.slice(0,7)+";color:"+e.hex.slice(0,7))}})):(n={type:"color",showPalette:!1,showAlpha:!1,allowEmpty:!0,disabled:!!t.disabled,preferredFormat:"hex",showInput:!0},t.isReadOnly()&&h.extend(n,{beforeShow:function(e){return!1}}),f(t.el).find("#"+g(t.id)).spectrum(n))}},textarea:{template:'<textarea id="<%= id %>" name="<%= node.name %>" class="<%= fieldHtmlClass || cls.textualInputClass %>" style="height:<%= elt.height || "150px" %>;width:<%= elt.width || "100%" %>;" aria-label="<%= node.title ? escape(node.title) : node.name %>"<%= (node.disabled? " disabled" : "")%><%= (node.isReadOnly() ? " readonly=\'readonly\'" : "") %><%= (node.schemaElement && node.schemaElement.minLength ? " minlength=\'" + node.schemaElement.minLength + "\'" : "") %><%= (node.schemaElement && node.schemaElement.maxLength ? " maxlength=\'" + node.schemaElement.maxLength + "\'" : "") %><%= (node.required ? " required=\'required\'" : "") %><%= (node.placeholder? " placeholder=" + \'"\' + escape(node.placeholder) + \'"\' : "")%>><%= value %></textarea>',fieldtemplate:!0,inputfield:!0},wysihtml5:{template:'<textarea id="<%= id %>" name="<%= node.name %>" style="height:<%= elt.height || "300px" %>;width:<%= elt.width || "100%" %>;" aria-label="<%= node.title ? escape(node.title) : node.name %>"class="<%= fieldHtmlClass || cls.textualInputClass %>" <%= (node.disabled? " disabled" : "")%><%= (node.isReadOnly() ? " readonly=\'readonly\'" : "") %><%= (node.schemaElement && node.schemaElement.minLength ? " minlength=\'" + node.schemaElement.minLength + "\'" : "") %><%= (node.schemaElement && node.schemaElement.maxLength ? " maxlength=\'" + node.schemaElement.maxLength + "\'" : "") %><%= (node.required ? " required=\'required\'" : "") %><%= (node.placeholder? " placeholder=" + \'"\' + escape(node.placeholder) + \'"\' : "")%>><%= value %></textarea>',fieldtemplate:!0,inputfield:!0,onInsert:function(e,t){function n(){f(t.el).data("wysihtml5")||(f(t.el).data("wysihtml5_loaded",!0),f(t.el).find("#"+g(t.id)).wysihtml5({toolbar:{html:!0,emphasis:!0,link:!!f.fn.modal,image:!!f.fn.modal,color:!1,fa:"fa"===t.ownerTree.defaultConfig.iconClassPrefix.slice(-2)},events:{load:function(){f(this.editableElement).prop("required",!1)}}}))}var i;window.jsonform_wysihtml5_setup?window.jsonform_wysihtml5_setup(n):i=window.setInterval(function(){window.wysihtml5&&(window.clearInterval(i),n())},1e3)}},summernote:{template:'<textarea id="<%= id %>" name="<%= node.name %>" style="height:<%= elt.height || "300px" %>;width:<%= elt.width || "100%" %>;" aria-label="<%= node.title ? escape(node.title) : node.name %>"class="<%= fieldHtmlClass || cls.textualInputClass %>" <%= (node.disabled? " disabled" : "")%><%= (node.isReadOnly() ? " readonly=\'readonly\'" : "") %><%= (node.schemaElement && node.schemaElement.minLength ? " minlength=\'" + node.schemaElement.minLength + "\'" : "") %><%= (node.schemaElement && node.schemaElement.maxLength ? " maxlength=\'" + node.schemaElement.maxLength + "\'" : "") %><%= (node.required ? " required=\'required\'" : "") %><%= (node.placeholder? " placeholder=" + \'"\' + escape(node.placeholder) + \'"\' : "")%>><%= value %></textarea>',fieldtemplate:!0,inputfield:!0,onInsert:function(e,t){var n,i;n=t.formElement||{},i={placeholder:t.placeholder||null,height:n.height||"300px",width:n.width||"100%",disableDragAndDrop:!0,codeviewFilter:!0,spellCheck:!1,disableGrammar:!0,callbacks:{onInit:function(){f(this).prop("required",!1)}},toolbar:[["style",["style"]],["color",["color"]],["font",["bold","italic","underline","clear"]],["para",["ul","ol","paragraph"]],["table",["table"]],["view",["codeview"]],["insert",["link","picture"]]]},"fa"===t.ownerTree.defaultConfig.iconClassPrefix.slice(-2)&&h.extend(i,{icons:{align:'<i class="'+t.ownerTree.defaultConfig.iconClassPrefix+'-align-left"/>',alignCenter:'<i class="'+t.ownerTree.defaultConfig.iconClassPrefix+'-align-center"/>',alignJustify:'<i class="'+t.ownerTree.defaultConfig.iconClassPrefix+'-align-justify"/>',alignLeft:'<i class="'+t.ownerTree.defaultConfig.iconClassPrefix+'-align-left"/>',alignRight:'<i class="'+t.ownerTree.defaultConfig.iconClassPrefix+'-align-right"/>',indent:'<i class="'+t.ownerTree.defaultConfig.iconClassPrefix+'-indent"/>',outdent:'<i class="'+t.ownerTree.defaultConfig.iconClassPrefix+'-outdent"/>',arrowsAlt:'<i class="'+t.ownerTree.defaultConfig.iconClassPrefix+'-arrows-alt"/>',bold:'<i class="'+t.ownerTree.defaultConfig.iconClassPrefix+'-bold"/>',caret:'<i class="'+t.ownerTree.defaultConfig.iconClassPrefix+'-caret-down"/>',circle:'<i class="'+t.ownerTree.defaultConfig.iconClassPrefix+'-circle"/>',close:'<i class="'+t.ownerTree.defaultConfig.iconClassPrefix+'-times"/>',code:'<i class="'+t.ownerTree.defaultConfig.iconClassPrefix+'-code"/>',eraser:'<i class="'+t.ownerTree.defaultConfig.iconClassPrefix+'-eraser"/>',italic:'<i class="'+t.ownerTree.defaultConfig.iconClassPrefix+'-italic"/>',link:'<i class="'+t.ownerTree.defaultConfig.iconClassPrefix+'-link"/>',unlink:'<i class="'+t.ownerTree.defaultConfig.iconClassPrefix+'-unlink"/>',magic:'<i class="'+t.ownerTree.defaultConfig.iconClassPrefix+'-magic"/>',menuCheck:'<i class="'+t.ownerTree.defaultConfig.iconClassPrefix+'-check"/>',minus:'<i class="'+t.ownerTree.defaultConfig.iconClassPrefix+'-minus"/>',orderedlist:'<i class="'+t.ownerTree.defaultConfig.iconClassPrefix+'-list-ol"/>',pencil:'<i class="'+t.ownerTree.defaultConfig.iconClassPrefix+'-pencil-alt"/>',picture:'<i class="'+t.ownerTree.defaultConfig.iconClassPrefix+'-image"/>',question:'<i class="'+t.ownerTree.defaultConfig.iconClassPrefix+'-question"/>',redo:'<i class="'+t.ownerTree.defaultConfig.iconClassPrefix+'-redo"/>',square:'<i class="'+t.ownerTree.defaultConfig.iconClassPrefix+'-square"/>',strikethrough:'<i class="'+t.ownerTree.defaultConfig.iconClassPrefix+'-strikethrough"/>',subscript:'<i class="'+t.ownerTree.defaultConfig.iconClassPrefix+'-subscript"/>',superscript:'<i class="'+t.ownerTree.defaultConfig.iconClassPrefix+'-superscript"/>',table:'<i class="'+t.ownerTree.defaultConfig.iconClassPrefix+'-table"/>',textHeight:'<i class="'+t.ownerTree.defaultConfig.iconClassPrefix+'-text-height"/>',trash:'<i class="'+t.ownerTree.defaultConfig.iconClassPrefix+'-trash-alt"/>',underline:'<i class="'+t.ownerTree.defaultConfig.iconClassPrefix+'-underline"/>',undo:'<i class="'+t.ownerTree.defaultConfig.iconClassPrefix+'-undo"/>',unorderedlist:'<i class="'+t.ownerTree.defaultConfig.iconClassPrefix+'-list-ul"/>',video:'<i class="'+t.ownerTree.defaultConfig.iconClassPrefix+'-film"/>'}}),n.summernote&&"object"==typeof n.summernote&&h.extend(i,n.summernote),f(t.el).find("#"+g(t.id)).summernote(i),(t.disabled||t.isReadOnly())&&f(t.el).find("#"+g(t.id)).summernote("disable")}},ace:{template:'<div id="<%= id %>" style="position:relative;height:<%= elt.height || "300px" %>;"><div id="<%= id %>__ace" style="width:<%= elt.width || "100%" %>;height:<%= elt.height || "300px" %>;"></div><input type="hidden" name="<%= node.name %>" id="<%= id %>__hidden" value="<%= escape(value) %>"/></div>',fieldtemplate:!0,inputfield:!0,onBeforeRender:function(e,t){(e.value&&"object"==typeof e.value||Array.isArray(e.value))&&(e.value=m.stringify(e.value,null,2))},onInsert:function(e,i){function t(){var e=i.formElement||{},t=window.ace.edit(f(i.el).find("#"+g(i.id)+"__ace").get(0)),n="#"+g(i.id)+"__hidden";t.getSession().setNewLineMode("unix"),t.renderer.setShowPrintMargin(!1),t.setTheme("ace/theme/"+(e.aceTheme||"twilight")),e.aceMode&&t.getSession().setMode("ace/mode/"+e.aceMode),t.getSession().setTabSize(2);null==(e=i.value)?e="":"object"!=typeof e&&!Array.isArray(e)||(e=m.stringify(e,null,2)),t.getSession().setValue(e),e=h.debounce(function(){f(i.el).find(n).val(t.getSession().getValue()),f(i.el).find(n).trigger("change")},600);t.getSession().on("change",e),t.on("blur",function(){f(i.el).find(n).trigger("change"),f(i.el).find(n).trigger("blur")}),t.on("focus",function(){f(i.el).find(n).trigger("focus")})}var n;window.jsonform_ace_setup?window.jsonform_ace_setup(t):n=window.setInterval(function(){window.ace&&(window.clearInterval(n),t())},1e3)}},checkbox:{template:'<div class="<%= cls.checkboxWrapClass %>"><input class=\'<%= cls.checkboxInputClass %><%= (checkboxTitle ? "" : " position-static") %><%= (fieldHtmlClass ? " " + fieldHtmlClass : "") %>\' type="checkbox" id="<%= id %>" value="1" name="<%= node.name %>" aria-label="<%= node.title ? escape(node.title) : node.name %>" <% if (value) {%>checked <% } %><%= (node.isReadOnly() ? "readonly=\'readonly\' " : "") %><%= (node.disabled || node.isReadOnly() ? "disabled " : "") %><%= (node.required && node.schemaElement && (node.schemaElement.type !== "boolean") ? " required=\'required\'" : "") %>/><% if (checkboxTitle) { %><label class="<%= cls.checkboxLabelClass %>" for="<%= id %>"><%= checkboxTitle || "" %></label><% } %></div>',fieldtemplate:!0,inputfield:!0,onBeforeRender:function(e,t){e.checkboxTitle=!0===t.inlinetitle?t.title:t.inlinetitle},onInsert:function(e,t){var n,i,l;t.formElement.toggleNext&&(i="jsonform-toggle-next jsonform-toggle-next-"+(n=!0===t.formElement.toggleNext?1:t.formElement.toggleNext),(l=1===n?f(t.el).next():"all"===n?f(t.el).nextAll():f(t.el).nextAll().slice(0,n)).addClass("jsonform-toggle-next-target"),f(t.el).addClass(i).find(":checkbox").on("change",function(){var e=f(this).is(":checked");f(t.el).toggleClass("checked",e),l.toggle(e).toggleClass("jsonform-toggled-visible",e)}).trigger("change"))},getElement:function(e){return f(e).parent().get(0)}},switch:{template:'<div class="<%= cls.switchWrapClass %>"><input class=\'<%= cls.switchInputClass %><%= (fieldHtmlClass ? " " + fieldHtmlClass : "") %>\' type="checkbox" id="<%= id %>" value="1" name="<%= node.name %>" aria-label="<%= node.title ? escape(node.title) : node.name %>" <% if (value) {%>checked <% } %><%= (node.isReadOnly() ? "readonly=\'readonly\' " : "") %><%= (node.disabled || node.isReadOnly() ? "disabled " : "") %><%= (node.required && node.schemaElement && (node.schemaElement.type !== "boolean") ? " required=\'required\'" : "") %>/><label class="<%= cls.switchLabelClass %>" for="<%= id %>"><%= switchTitle || "" %></label></div>',fieldtemplate:!0,inputfield:!0,onBeforeRender:function(e,t){e.switchTitle=!0===t.inlinetitle?t.title:t.inlinetitle},onInsert:function(e,t){var n,i,l;t.formElement.toggleNext&&(i="jsonform-toggle-next jsonform-toggle-next-"+(n=!0===t.formElement.toggleNext?1:t.formElement.toggleNext),(l=1===n?f(t.el).next():"all"===n?f(t.el).nextAll():f(t.el).nextAll().slice(0,n)).addClass("jsonform-toggle-next-target"),f(t.el).addClass(i).find(":checkbox").on("change",function(){var e=f(this).is(":checked");f(t.el).toggleClass("checked",e),l.toggle(e).toggleClass("jsonform-toggled-visible",e)}).trigger("change"))},getElement:function(e){return f(e).parent().get(0)}},file:{template:'<input class="input-file form-control-file" id="<%= id %>" name="<%= node.name %>" type="file" <%= (node.required ? " required=\'required\'" : "") %><%= (node.formElement && node.formElement.accept ? (" accept=\'" + node.formElement.accept + "\'") : "") %>/>',fieldtemplate:!0,inputfield:!0},select:{template:'<% if (cls.selectWrapClass) { %><div class="<%= cls.selectWrapClass %>"><% } %><select name="<%= node.name %>" id="<%= id %>" class="<%= fieldHtmlClass || cls.textualInputClass %>"<%= (node.schemaElement && node.schemaElement.disabled? " disabled" : "")%><%= (node.required ? " required=\'required\'" : "") %>> <% _.each(node.options, function(key, val) { if(key instanceof Object) { if (value === key.value) { %> <option selected value="<%= key.value %>"><%= key.title %></option> <% } else { %> <option value="<%= key.value %>"><%= key.title %></option> <% }} else { if (value === key) { %> <option selected value="<%= key %>"><%= key %></option> <% } else { %><option value="<%= key %>"><%= key %></option> <% }}}); %> </select><% if (cls.selectWrapClass) { %></div><% } %>',fieldtemplate:!0,inputfield:!0},tagsinput:{template:'<select name="<%= node.name %><%= node.formElement.getValue === "tagsinput" ? "" : "[]" %>" id="<%= id %>" class="<%= fieldHtmlClass || cls.textualInputClass %>" multiple<%= (node.disabled? " disabled" : "")%><%= (node.required ? " required=\'required\'" : "") %>> </select>',fieldtemplate:!0,inputfield:!0,onInsert:function(e,t){if(!f.fn.tagsinput)throw new Error("tagsinput is not found");var n=f(t.el).find("select"),i={};t.schemaElement&&"array"===t.schemaElement.type&&(t.schemaElement.maxItems&&-1<t.schemaElement.maxItems&&(i.maxTags=t.schemaElement.maxItems),i.allowDuplicates=!t.schemaElement.uniqueItems,"object"==typeof t.schemaElement.items&&"string"===t.schemaElement.items.type&&(i.maxChars=t.schemaElement.items.maxLength&&-1<t.schemaElement.items.maxLength?t.schemaElement.items.maxLength:void 0)),t.formElement&&t.formElement.tagsinput&&h.extend(i,t.formElement.tagsinput),n.tagsinput(i),t.value&&t.value.forEach(function(e){n.tagsinput("add",e)})}},imageselect:{template:'<div><input type="hidden" name="<%= node.name %>" id="<%= node.id %>" value="<%= value %>" /><div class="dropdown"><a class="btn <%= cls.buttonClass %> <%= cls.dropdownInputClass %>" data-toggle="dropdown" href="#"<% if (node.value) { %> style="max-width:<%= width %>px;max-height:<%= height %>px"<% } %>><% if (node.value) { %><img class="<%= cls.imgResponsiveClass %>" src="<% if (!node.value.match(/^https?:/)) { %><%= prefix %><% } %><%= node.value %><%= suffix %>" alt="" /><% } else { %><%= buttonTitle %><% } %></a><div class="dropdown-menu <%= cls.dropdownMenuClass %>" id="<%= node.id %>_dropdown"><div><% _.each(node.options, function(key, idx) { if ((idx > 0) && ((idx % columns) === 0)) { %></div><div><% } %><a class="btn<% if (buttonClass) { %> <%= buttonClass %><% } %>" style="max-width:<%= width %>px;max-height:<%= height %>px"><% if (key instanceof Object) { %><img class="<%= cls.imgResponsiveClass %>" src="<% if (!key.value.match(/^https?:/)) { %><%= prefix %><% } %><%= key.value %><%= suffix %>" alt="<%= key.title %>" /></a><% } else { %><img class="<%= cls.imgResponsiveClass %>" src="<% if (!key.match(/^https?:/)) { %><%= prefix %><% } %><%= key %><%= suffix %>" alt="" /><% } %></a> <% }); %></div><div class="<%= cls.placementClassPrefix %>-right"><a class="btn <%= cls.buttonClass %>">Reset</a></div></div></div></div>',fieldtemplate:!0,inputfield:!0,onBeforeRender:function(e,t){var n=t.formElement||{},i=n.imageSelectorColumns||5;e.buttonTitle=n.imageSelectorTitle||"Select...",e.prefix=n.imagePrefix||"",e.suffix=n.imageSuffix||"",e.width=n.imageWidth||32,e.height=n.imageHeight||32,e.buttonClass=n.imageButtonClass||!1,t.options.length>i?(n=Math.ceil(t.options.length/i),e.columns=Math.ceil(t.options.length/n)):e.columns=i},getElement:function(e){return f(e).parent().get(0)},onInsert:function(e,s){f(s.el).on("click",".dropdown-menu a",function(e){e.preventDefault(),e.stopPropagation();var e=("img"===e.target.nodeName.toLowerCase()?f(e.target):f(e.target).find("img")).attr("src"),t=s.formElement||{},n=t.imagePrefix||"",i=t.imageSuffix||"",l=t.imageWidth||32,a=t.imageHeight||32;e?(e=(e=0===e.indexOf(n)?e.substring(n.length):e).substring(0,e.length-i.length),f(s.el).find("input").attr("value",e),f(s.el).find('a[data-toggle="dropdown"]').attr("style","max-width:"+l+"px;max-height:"+a+"px").html('<img class="'+s.ownerTree.defaultConfig.imgResponsiveClass+'" src="'+(e.match(/^https?:/)?"":n)+e+i+'" alt="" />').dropdown("hide")):(f(s.el).find("input").attr("value",""),f(s.el).find('a[data-toggle="dropdown"]').removeAttr("style").html(t.imageSelectorTitle||"Select...").dropdown("hide"))})}},iconselect:{template:'<div><input type="hidden" name="<%= node.name %>" id="<%= node.id %>" value="<%= value %>" /><div class="dropdown"><a class="btn <%= cls.buttonClass %> <%= cls.dropdownInputClass %>" data-toggle="dropdown" href="#"><% if (node.value) { %><i class="<%= cls.iconClassPrefix %>-<%= node.value %><% if (isFaIcon) { %> fa-fw<% } %>" alt="" /><% } else { %><%= buttonTitle %><% } %></a><div class="dropdown-menu <%= cls.dropdownMenuClass %>" id="<%= node.id %>_dropdown"><div><% _.each(node.options, function(key, idx) { if ((idx > 0) && ((idx % columns) === 0)) { %></div><div><% } %><a class="btn<% if (buttonClass) { %> <%= buttonClass %><% } %>"><% if (key instanceof Object) { %><i class="<%= cls.iconClassPrefix %>-<%= key.value %><% if (isFaIcon) { %> fa-fw<% } %>" alt="<%= key.title %>"></i><% } else { %><i class="<%= cls.iconClassPrefix %>-<%= key %><% if (isFaIcon) { %> fa-fw<% } %>" alt=""></i><% } %></a> <% }); %></div><div class="<%= cls.placementClassPrefix %>-right"><a class="btn <%= cls.buttonClass %>">Reset</a></div></div></div></div>',fieldtemplate:!0,inputfield:!0,onBeforeRender:function(e,t){var n=t.formElement||{},i=n.imageSelectorColumns||5;e.buttonTitle=n.imageSelectorTitle||"Select...",e.buttonClass=n.imageButtonClass||!1,e.isFaIcon="fa"===e.cls.iconClassPrefix.slice(-2),t.options.length>i?(n=Math.ceil(t.options.length/i),e.columns=Math.ceil(t.options.length/n)):e.columns=i},getElement:function(e){return f(e).parent().get(0)},onInsert:function(e,i){f(i.el).on("click",".dropdown-menu a",function(e){e.preventDefault(),e.stopPropagation();var e=("i"===e.target.nodeName.toLowerCase()?f(e.target):f(e.target).find("i")).attr("class"),t=i.formElement||{},n="fa"===i.ownerTree.defaultConfig.iconClassPrefix.slice(-2);e?(0===e.indexOf(i.ownerTree.defaultConfig.iconClassPrefix)&&(e=e.substring(i.ownerTree.defaultConfig.iconClassPrefix.length+1)),n&&(e=e.substring(0,e.length-" fa-fw".length)),f(i.el).find("input").attr("value",e),f(i.el).find('a[data-toggle="dropdown"]').html('<i class="'+i.ownerTree.defaultConfig.iconClassPrefix+"-"+e+(n?" fa-fw":"")+'" alt="" />').dropdown("hide")):(f(i.el).find("input").attr("value",""),f(i.el).find('a[data-toggle="dropdown"]').html(t.imageSelectorTitle||"Select...").dropdown("hide"))})}},radios:{template:'<div id="<%= node.id %>"<% if (elt.inline) { %> class="<%= cls.formInlineClass %>"<% } %>><% _.each(node.options, function(key, val) { %><div class="<% if (elt.inline) { %><%= cls.radioWrapInlineClass %><% } else { %><%= cls.radioWrapClass %><% } %>"><input class=\'<%= cls.radioInputClass %><%= (fieldHtmlClass ? " " + fieldHtmlClass : "") %>\' type="radio" id="<%= node.id %>_<%= escape(key instanceof Object ? key.title : key) %>" value="<%= (key instanceof Object ? key.value : key) %>" name="<%= node.name %>" aria-label="<%= (key instanceof Object ? key.title : key) %>" <% if (((key instanceof Object) && (value === key.value)) || (value === key)) { %>checked="checked" <% } else { %><%= (node.isReadOnly() ? "disabled " : "") %><% } %><%= (node.disabled ? "disabled " : "") %><%= (node.required ? "required=\'required\'" : "") %>/><label class="<%= cls.radioLabelClass %>" for="<%= node.id %>_<%= escape(key instanceof Object ? key.title : key) %>"><%= (key instanceof Object ? key.title : key) %></label></div><% }); %></div>',fieldtemplate:!0,inputfield:!0,onInsert:function(e,t){if(t.formElement.toggleNextMap){var n,a={};for(n in t.formElement.toggleNextMap){var i=t.formElement.toggleNextMap[n],i=!0===i?1:i,l="jsonform-toggle-next jsonform-toggle-next-"+i,i=1===i?f(t.el).next():"all"===i?f(t.el).nextAll():f(t.el).nextAll().slice(0,i);i.addClass("jsonform-toggle-next-target"),a[n]=i}f(t.el).addClass(l).find(":radio").on("change",function(){var e,t=f(this),n=t.val(),i=t.is(":checked");for(e in a){var l=a[e];i&&e===n?l.toggle(!0).toggleClass("jsonform-toggled-visible",!0):l.toggle(!1).toggleClass("jsonform-toggled-visible",!1)}}).trigger("change")}}},radiobuttons:{template:'<div id="<%= node.id %>" class="<%= cls.buttonGroupClass %> btn-group-toggle" data-toggle="buttons"><% _.each(node.options, function(key, val) { %><label class="btn <% if (((key instanceof Object) && (value === key.value)) || (value === key)) { %>active <%= elt.activeClass ? elt.activeClass : cls.buttonClass %><% } else { %><%= cls.buttonClass %><% } %><%= (node.disabled || node.isReadOnly() ? " disabled" : "") %>"><input type="radio" style="position:absolute;left:-9999px;" <%= (fieldHtmlClass ? "class=\'" + fieldHtmlClass + "\' ": "") %>name="<%= node.name %>" value="<%= (key instanceof Object ? key.value : key) %>" <% if (((key instanceof Object) && (value === key.value)) || (value === key)) { %>checked="checked" <% } %><%= (node.disabled ? "disabled" : "") %>/><%= (key instanceof Object ? key.title : key) %></label> <% }); %></div>',fieldtemplate:!0,inputfield:!0,onInsert:function(e,t){var n,i;t.disabled||t.isReadOnly()||(n="active",(i=t.formElement||{}).activeClass?n+=" "+i.activeClass:n+=" "+t.ownerTree.defaultConfig.buttonClass,f(t.el).find("label.btn").on("click",function(){f(this).parent().find("label.btn").removeClass(n).addClass(t.ownerTree.defaultConfig.buttonClass),f(this).removeClass(t.ownerTree.defaultConfig.buttonClass).addClass(n)}).find(":checked").closest("label.btn").addClass(n))}},checkboxes:{template:'<div id="<%= node.id %>"<% if (elt.inline) { %> class="<%= cls.formInlineClass %>"<% } %>><%= choiceshtml %><%= children %></div>',fieldtemplate:!0,inputfield:!0,childTemplate:function(e,t){if(!t.formElement.otherField)return e;var n='<div class="'+(t.formElement.inline?"<%= cls.checkboxWrapInlineClass %>":"<%= cls.checkboxWrapClass %>")+(t.formElement.otherField.inline?" inline-":" ")+'other-field">',i=(t.formElement.otherField.asArrayValue&&t.otherValues&&(n+='<% value = node.parentNode.otherValues.join(", ") %>'),t.key+"["+(void 0!==t.formElement.otherField.idx?t.formElement.otherField.idx:t.formElement.options.length)+"]");return n+='<input class=\'<%= cls.checkboxInputClass %><%= (fieldHtmlClass ? " " + fieldHtmlClass : "") %>\' type="checkbox" id="'+i+'" aria-label="<%= node.title || "Other" %>" <% if ((value !== undefined) && (value !== null) && (value !== "")) {%>checked="checked" <% } else { %><%= (node.isReadOnly() ? "disabled " : "") %><% } %><%= (node.disabled ? "disabled " : "") %>',(t.formElement.otherField.asArrayValue||!0===t.formElement.otherField.novalue)&&!1!==t.formElement.otherField.novalue||(n+=' name="'+i+'" value="'+(t.formElement.optionsAsEnumOrder?1:t.formElement.otherField.otherValue||"OTHER")+'"'),n=n+"/>"+('<label class="<%= cls.checkboxLabelClass %>" for="'+i+'"><%= node.title || "Other" %></label>'),n=t.formElement.otherField.inline?n+'<div class="other-field-content">'+e+"</div></div>":n+'</div><div class="other-field-content">'+e+"</div>"},onBeforeRender:function(e,n){var t,i,l,a,s;n&&n.schemaElement&&((t=n.formElement.options)&&(i='<div class="'+(n.formElement.inline?e.cls.checkboxWrapInlineClass:e.cls.checkboxWrapClass)+"\"><input class='"+e.cls.checkboxInputClass+'<%= (title ? "" : " position-static") %><%= (node.formElement.fieldHtmlClass ? " " + node.formElement.fieldHtmlClass : "") %>\' type="checkbox" id="<%= name %>" value="<%= escape(value) %>" name="<%= name %>" aria-label="<%= title ? escape(title) : name %>" <% if (checked) {%>checked="checked" <% } else { %><%= (node.isReadOnly() ? "disabled " : "") %><% } %><%= (node.disabled ? "disabled" : "") %>/><% if (title) { %><label class="'+e.cls.checkboxLabelClass+'" for="<%= name %>"><%= title || "" %></label><% } %></div>',l="",n.formElement.otherField&&n.formElement.otherField.asArrayValue&&n.value?(a=t.map(function(e){return e.value}),s=[],n.value.forEach(function(e){h.include(a,e)||s.push(e)}),0<s.length&&(n.otherValues=s)):delete n.otherValues,h.each(t,function(e,t){n.formElement.otherField&&e.value===(n.formElement.otherField.otherValue||"OTHER")?n.formElement.otherField.idx=t:l+=h.template(i,w)({name:n.key+"["+t+"]",value:n.formElement.optionsAsEnumOrder?1:e.value,checked:h.include(n.value,e.value),title:e.title,node:n,escape:p})}),n.formElement.otherField,e.choiceshtml=l))},onInsert:function(e,t){var n=t.formElement.otherField&&t.formElement.otherField.inline?f(t.el).find(".inline-other-field :checkbox").first():f(t.el).find(".other-field :checkbox"),i=f(t.el).find(".other-field-content :input");function l(){var t;n.prop("checked",(t=!1,i.each(function(){var e=f(this);return e.is(":checkbox, :radio")&&e.prop("checked")||!e.is("button")&&""!==f(this).val()?!(t=!0):void 0}),t))}i.on("keyup",l).on("change",l).trigger("change"),n.on("change",function(){this.checked?(this.checked=!1,i.not(":checkbox,:radio,button").trigger("focus")):i.filter("input[type=text], textarea").val("")})}},checkboxbuttons:{template:'<div id="<%= node.id %>" class="<%= cls.buttonGroupClass %> btn-group-toggle" data-toggle="buttons"><%= choiceshtml %></div>',fieldtemplate:!0,inputfield:!0,onBeforeRender:function(n,i){var e,l=null,a='<label class="btn <% if (checked) { %>active <%= node.formElement && node.formElement.activeClass ? node.formElement.activeClass : cls.buttonClass %><% } else { %><%= cls.buttonClass %><% } %><%= (node.disabled || node.isReadOnly() ? " disabled" : "") %>"><input type="checkbox" style="position:absolute;left:-9999px;" '+(n.fieldHtmlClass?'class="'+n.fieldHtmlClass+'" ':"")+'<% if (checked) { %> checked="checked" <% } %> name="<%= name %>" value="<%= value %>" <%= (node.disabled ? "disabled" : "") %>/><%= title %></label> ';i&&i.schemaElement&&(e=i.formElement.options)&&(i.value&&Array.isArray(i.value)||(i.value=[]),l="",h.each(e,function(e,t){l+=h.template(a,w)({name:i.key+"["+t+"]",checked:h.include(i.value,e.value),value:e.value,title:e.title,node:i,cls:n.cls})}),n.choiceshtml=l)},onInsert:function(e,t){var n=(t.formElement||{}).activeClass||t.ownerTree.defaultConfig.buttonClass;f(t.el).find("label.btn").on("click",function(){f(this).find("input:checkbox").prop("checked")?(f(this).removeClass(t.ownerTree.defaultConfig.buttonClass),f(this).toggleClass(n,!0)):(f(this).toggleClass(n,!1),f(this).addClass(t.ownerTree.defaultConfig.buttonClass))}).find(":checked").closest("label.btn").addClass(n)}},array:{template:'<div id="<%= id %>"><ul class="_jsonform-array-ul" style="list-style-type:none;"><%= children %></ul><% if (!node.isReadOnly()) { %><span class="_jsonform-array-buttons"><a href="#" class="btn <%= cls.buttonClass %> _jsonform-array-addmore"><i class="<%= cls.iconClassPrefix %>-plus" title="<%= node.formElement.addMoreTooltip ? escape(node.formElement.addMoreTooltip) : \'Add new item\'%>"></i> <%= node.formElement.addMoreTitle || \'\'%></a> </span><% } %></div>',fieldtemplate:!0,array:!0,childTemplate:function(e,t){var n='<span class="_jsonform-array-legend"><%= escape(node.legend) || "" %></span> ';return t.isReadOnly()||(!f("").sortable||u(t.formElement.draggable)&&!t.formElement.draggable||(n+='<span class="draggable line"><i class="<%= cls.iconClassPrefix %>-list" title="Move item"></i></span> '),n+='<a href="#" class="_jsonform-array-item-delete"><i class="<%= cls.iconClassPrefix %>-trash" title="Remove item"></i></a>'),'<li data-idx="<%= node.childPos %>">'+n+e+"</li>"},onInsert:function(e,r){function d(){h.each(r.children,function(e,t){f('> ul._jsonform-array-ul > li[data-idx="'+t+'"] > span._jsonform-array-legend',c).html(p(e.legend||""))});var e=0<=i.minItems&&r.children.length<=i.minItems;c.find(a).toggle(!e)}function n(e){if(0<=i.maxItems){var t=i.maxItems-r.children.length;if(c.find(l).toggleClass("disabled",t<=1),t<1)return}r.insertArrayItem(e,f("> ul",c).get(0)),r.ownerTree.defaultConfig.useTooltip&&v(),d()}var c=f(r.el).find("#"+g(r.id)),i=r.getArrayBoundaries(),l="> span > a._jsonform-array-addmore",a="> ul > li > a._jsonform-array-item-delete";if(c.off("click",l).on("click",l,function(e){var t=r.children.length;e.preventDefault(),e.stopPropagation(),n(t)}),c.off("click",a).on("click",a,function(e){e.preventDefault(),e.stopPropagation();var e=f(e.currentTarget).parent().data("idx"),t=r.children.length-Math.max(i.minItems,0);c.find(a).toggle(1<t),t<1||(r.deleteArrayItem(e),d(),c.find(l).toggleClass("disabled",0<=i.maxItems&&r.children.length>=i.maxItems))}),f(r.el).on("legendUpdated",function(e){d(),e.preventDefault(),e.stopPropagation()}),u(r.formElement.draggable)&&!r.formElement.draggable||!r.isReadOnly()&&f(r.el).sortable&&(f("> ul",c).sortable(),f("> ul",c).on("sortstop",function(e,t){var n=f(t.item).data("idx"),t=f(t.item).index(),i=t;if(n!==i){for(var l=n<i?1:-1,a=0,s=f("> ul",c),a=n;a!==i;a+=l)r.children[a].switchValuesWith(r.children[a+l]),r.children[a].render(s.get(0)),r.children[a+l].render(s.get(0));var t=f(r.children[n].el),o=f(r.children[i].el);t.detach(),o.detach(),n<i?(0===n?s.prepend(t):f(r.children[n-1].el).after(t),f(r.children[i-1].el).after(o)):(0===i?s.prepend(o):f(r.children[i-1].el).after(o),f(r.children[n-1].el).after(t))}d()})),0<=i.minItems)for(var t=r.children.length;t<i.minItems;t++)n(r.children.length);d(),c.find(l).toggleClass("disabled",0<=i.maxItems&&r.children.length>=i.maxItems);var s=0<=i.minItems&&r.children.length<=i.minItems;c.find(a).toggle(!s)}},tabarray:{template:'<div id="<%= id %>"><div class="jsonform-tabbable"><ul class="nav <%= cls.navTabsClass %>"><%= tabs %></ul><div style="clear: both;"></div><div class="tab-content"><%= children %></div></div></div>',fieldtemplate:!0,array:!0,childTemplate:function(e){return'<div data-idx="<%= node.childPos %>" class="tab-pane">'+e+"</div>"},onBeforeRender:function(e,t){e.tabs=""},onInsert:function(e,o){function r(e){var n="",t=!1,i=((e=void 0===e?(e=f("> .jsonform-tabbable > ul.nav .active",d).data("idx"))?parseInt(e,10):(t=!0,0):e)>=o.children.length&&(e=o.children.length-1),h.each(o.children,function(e,t){f('> .jsonform-tabbable > .tab-content > [data-idx="'+t+'"] > fieldset > legend',d).html(e.legend);e=e.legend||e.title||"Item "+(t+1);n+='<li class="tabwrap '+o.ownerTree.defaultConfig.navItemClass+'" data-idx="'+t+'"><a class="draggable tab '+o.ownerTree.defaultConfig.navLinkClass+'" data-toggle="tab" rel="'+escape(e)+'">'+p(e),o.isReadOnly()||(n+=' <span href="#" class="_jsonform-array-item-delete"><i class="'+o.ownerTree.defaultConfig.iconClassPrefix+'-trash" title="Remove item"></i></span></a>'),n+="</li>"}),!o.isReadOnly()&&(l.maxItems<0||o.children.length<l.maxItems)&&(n+='<li class="tabwrap '+o.ownerTree.defaultConfig.navItemClass+'" data-idx="-1"><a class="tab '+o.ownerTree.defaultConfig.navLinkClass+' _jsonform-array-addmore" title="'+(o.formElement.addMoreTooltip?p(o.formElement.addMoreTooltip):"Add new item")+'"><i class="'+o.ownerTree.defaultConfig.iconClassPrefix+'-plus"></i> '+(o.formElement.addMoreTitle||"New")+"</a></li>"),f("> .jsonform-tabbable > ul.nav",d).html(n),0<=l.minItems&&o.children.length<=l.minItems);d.find(a).toggle(!i),t&&f('> .jsonform-tabbable > ul.nav [data-idx="0"]',d).addClass("active").find("> a").addClass("active"),f('> .jsonform-tabbable > ul.nav [data-toggle="tab"]',d).eq(e).trigger("click")}function n(e){if(0<=l.maxItems){var t=l.maxItems-o.children.length;if(d.find(i).toggleClass("disabled",t<=1),t<1)return}o.insertArrayItem(e,d.find("> .jsonform-tabbable > .tab-content").get(0)),o.ownerTree.defaultConfig.useTooltip&&v(),r(e)}var d=f(o.el).find("#"+g(o.id)),l=o.getArrayBoundaries(),i="> .jsonform-tabbable > ul.nav > li > ._jsonform-array-addmore",a="> .jsonform-tabbable > ul.nav > li > a > ._jsonform-array-item-delete";if(d.off("click",i).on("click",i,function(e){var t=o.children.length;e.preventDefault(),e.stopPropagation(),n(t)}),d.off("click",a).on("click",a,function(e){e.preventDefault(),e.stopPropagation();var e=f(e.currentTarget).closest("li").data("idx"),t=o.children.length-Math.max(l.minItems,0);d.find(a).toggle(1<t),t<1||(o.deleteArrayItem(e),r(),d.find(i).toggleClass("disabled",0<=l.maxItems&&o.children.length>=l.maxItems))}),f(o.el).on("legendUpdated",function(e){r(),e.preventDefault(),e.stopPropagation()}),u(o.formElement.draggable)&&!o.formElement.draggable||!o.isReadOnly()&&f(o.el).sortable&&f("> .jsonform-tabbable > ul.nav",d).sortable({containment:o.el,cancel:"._jsonform-array-addmore",tolerance:"pointer"}).on("sortchange",function(e,t){t.placeholder.index()==f(this).children().length-1&&-1==t.placeholder.prev().data("idx")&&t.placeholder.prev().before(t.placeholder)}).on("sortstop",function(e,t){var n=f(t.item).data("idx"),t=f(t.item).index(),i=t;if(n!==i)for(var l=n<i?1:-1,a=0,s=f("> .jsonform-tabbable > .tab-content",d).get(0),a=n;a!==i;a+=l)o.children[a].switchValuesWith(o.children[a+l]),o.children[a].render(s),o.children[a+l].render(s);r(t)}),0<=l.minItems)for(var t=o.children.length;t<l.minItems;t++)n(o.children.length);r(),d.find(i).toggleClass("disabled",0<=l.maxItems&&o.children.length>=l.maxItems);var s=0<=l.minItems&&o.children.length<=l.minItems;d.find(a).toggle(!s)}},help:{template:'<small <%= id ? \'id="\' + id + \'"\' : "" %> class="<%= cls.helpClass %>" style="padding-top:5px"><%= node.helpvalue || elt.helpvalue %></small>',fieldtemplate:!0},null:{template:'<input type="hidden" id="<%= id %>" name="<%= node.name %>" value="null" <%= (node.disabled? " disabled" : "")%> />',inputfield:!0,fieldtemplate:!0},msg:{template:"<%= elt.msg %>"},html:{template:"<%= elt.html %>"},textview:{template:'<pre id="<%= id %>" name="<%= node.name %>"><%= value %></pre>',inputfield:!0,fieldtemplate:!0},fieldset:{template:'<fieldset class="jsonform-node jsonform-error-<%= keydash %> <% if (elt.expandable) { %>expandable<% } %> <%= elt.htmlClass?elt.htmlClass:"" %>" <% if (id) { %> id="<%= id %>"<% } %> data-jsonform-type="fieldset"<%= (node.disabled ? " disabled" : "") %>><% if (node.title || node.legend) { %><legend class="<%= cls.legendClass %>" role="treeitem" aria-expanded="false"><%= node.title || node.legend %><% if (node.description && (elt.useTooltip === true || (elt.useTooltip === undefined && cls.useTooltip))) { %><span data-toggle="tooltip" data-placement="right" title="<%= node.description %>" class="<%= cls.tooltipClass %> jsonform-description-tooltip"><i class="<%= cls.iconClassPrefix %>-<%= cls.tooltipIconSuffix %>"></i></span><% } %></legend><% } %><% if (node.description && !(elt.useTooltip === true || (elt.useTooltip === undefined && cls.useTooltip))) { %><small class="<%= cls.helpClass %> jsonform-description"><%= node.description %></small><% } %><% if (elt.expandable) { %><div class="<%= cls.formsGroupClass %>"><% } %><%= children %><% if (elt.expandable) { %></div><% } %><small class="<%= cls.errorTextClass %> jsonform-errortext" style="display:none;"></small></fieldset>',onInsert:function(e,t){null!==t.el&&(f(".expandable > div, .expandable > fieldset",t.el).hide(),f(".expandable",t.el).removeClass("expanded"))}},advancedfieldset:{template:'<fieldset class="jsonform-node jsonform-error-<%= keydash %> <% if (elt.expandable !== false) { %>expandable<% } %> <%= elt.htmlClass?elt.htmlClass:"" %>"<% if (id) { %> id="<%= id %>"<% } %> data-jsonform-type="advancedfieldset"<%= (node.disabled ? " disabled" : "") %>><legend class="<%= cls.legendClass %>" role="treeitem" aria-expanded="false"><%= (node.title || node.legend) ? (node.title || node.legend) : "Advanced options" %></legend><% if (elt.expandable !== false) { %><div class="<%= cls.formsGroupClass %>"><% } %><%= children %><% if (elt.expandable !== false) { %></div><% } %><small class="<%= cls.errorTextClass %> jsonform-errortext" style="display:none;"></small></fieldset>',onInsert:function(e,t){null!==t.el&&(f(".expandable > div, .expandable > fieldset",t.el).hide(),f(".expandable",t.el).removeClass("expanded"))}},authfieldset:{template:'<fieldset class="jsonform-node jsonform-error-<%= keydash %> <% if (elt.expandable !== false) { %>expandable<% } %> <%= elt.htmlClass?elt.htmlClass:"" %>"<% if (id) { %> id="<%= id %>"<% } %> data-jsonform-type="authfieldset"<%= (node.disabled ? " disabled" : "") %>><legend class="<%= cls.legendClass %>" role="treeitem" aria-expanded="false"><%= (node.title || node.legend) ? (node.title || node.legend) : "Authentication settings" %></legend><% if (elt.expandable !== false) { %><div class="<%= cls.formsGroupClass %>"><% } %><%= children %><% if (elt.expandable !== false) { %></div><% } %><small class="<%= cls.errorTextClass %> jsonform-errortext" style="display:none;"></small></fieldset>',onInsert:function(e,t){null!==t.el&&(f(".expandable > div, .expandable > fieldset",t.el).hide(),f(".expandable",t.el).removeClass("expanded"))}},submit:{template:'<input type="submit" <% if (id) { %> id="<%= id %>" <% } %> class="btn <%= cls.submitButtonClass %> <%= elt.htmlClass?elt.htmlClass:"" %>" value="<%= value || node.title %>"<%= (node.disabled? " disabled" : "")%>/>'},reset:{template:'<input type="reset" <% if (id) { %> id="<%= id %>" <% } %> class="btn <%= cls.resetButtonClass %> <%= elt.htmlClass?elt.htmlClass:"" %>" value="<%= value || node.title %>"<%= (node.disabled? " disabled" : "")%>/>'},button:{template:'<button type="button" <% if (id) { %> id="<%= id %>" <% } %> class="btn <%= cls.buttonClass %> <%= elt.htmlClass?elt.htmlClass:"" %>"><%= node.title %></button>'},actions:{template:'<div class="<%= cls.actionsClass %> <%= elt.htmlClass?elt.htmlClass:"" %>"><%= children %></div>'},hidden:{template:'<input type="hidden" id="<%= id %>" name="<%= node.name %>" value="<%= escape(value) %>" <%= (node.disabled? " disabled" : "")%> />',inputfield:!0},tabs:{template:'<div class="jsonform-tabbable"><ul class="nav <%= cls.navTabsClass %> <%= elt.htmlClass?elt.htmlClass:"" %>"<% if (elt.id) { %> id="<%= elt.id %>"<% } %>><%=tab_list%></ul><div style="clear: both;"></div><div class="tab-content" <% if (elt.id) { %> data-tabset="<%= elt.id %>"<% } %>><%=children%></div></div>',getElement:function(e){return f(e).parent().parent().get(0)},onBeforeRender:function(e,l){var a=p(l.id?l.id+"-":""),s="";return h.each(l.children,function(e,t){var n=p(e.title||"Item "+(t+1)),i=n.replace(" ","_");s+='<li class="tabwrap '+l.ownerTree.defaultConfig.navItemClass+(0===t?" active":"")+'"><a href="#'+a+i+'" class="tab '+l.ownerTree.defaultConfig.navLinkClass+(0===t?" active":"")+'" data-tab="'+a+i+'" data-toggle="tab">'+n+(e.formElement&&e.formElement.addIcon?'<i class="'+l.ownerTree.defaultConfig.iconClassPrefix+"-"+e.formElement.addIcon+'"></i>':"")+"</a></li>"}),e.tab_list=s,e},onInsert:function(e,t){f("#"+t.id+">li.tabwrap").on("click",function(e){e.preventDefault(),f(t.el).find("div[data-tabset='"+t.id+"']>div.tab-pane.active").each(function(){f(this).removeClass("active")});e=f(this).find("a").attr("data-tab");f("#"+e).addClass("active")})}},tab:{template:'<div class="tab-pane<% if (elt.htmlClass) { %> <%= elt.htmlClass %> <% } %><% if (node.childPos === 0) { %> active<% } %>" id="<%= tabId %>"><%= children %></div>',onBeforeRender:function(e,t){return e.tabId=p(t.parentNode.id?t.parentNode.id+"-":"")+p(t.title||"Item "+(t.childPos+1)).replace(" ","_"),e}},selectfieldset:{template:'<fieldset class="tab-container <%= elt.htmlClass?elt.htmlClass:"" %>"<%= (node.disabled ? " disabled" : "") %>><% if (node.legend) { %><legend class="<%= cls.legendClass %>" role="treeitem" aria-expanded="false"><%= node.legend %></legend><% } %><% if (node.formElement.key) { %><input type="hidden" id="<%= node.id %>" name="<%= node.name %>" value="<%= escape(value) %>" /><% } else { %><a id="<%= node.id %>"></a><% } %><div class="jsonform-tabbable"><div class="<%= cls.formClass %><%= node.formElement.hideMenu ? " hide" : "" %><%= (node.isReadOnly() ? " " + cls.formReadonlyClass : "") %><%= (node.disabled ? " " + cls.formDisabledClass : "") %>"><% if (!elt.notitle) { %><label class="<%= cls.labelClass %>" for="<%= node.id %>"><%= node.getTitle() %></label><% } %><div<% if (cls.controlClass) { %> class="<%= cls.controlClass %>"<% } %>><%= tabs %></div></div><div class="tab-content"><%= children %></div></div></fieldset>',inputfield:!0,getElement:function(e){return f(e).parent().get(0)},childTemplate:function(e){return'<div data-idx="<%= node.childPos %>" class="tab-pane<% if (node.active) { %> active<% } %>">'+e+"</div>"},onBeforeRender:function(e,i){var t=null,l=[],n=(i.schemaElement&&(l=i.schemaElement.enum||[]),t=i.options?h.map(i.options,function(e,t){var n=i.children[t];return n.childPos=t,e instanceof Object?((e=h.extend({node:n},e)).title=e.title||n.legend||n.title||"Option "+(n.childPos+1),e.value=u(e.value)?e.value:u(l[t])?l[t]:t,e):{title:e,value:u(l[n.childPos])?l[n.childPos]:n.childPos,node:n}}):h.map(i.children,function(e,t){return e.childPos=t,{title:e.legend||e.title||"Option "+(e.childPos+1),value:l[e.childPos]||e.value||e.childPos,node:e}}),h.each(t,function(e,t){e.node.active=!1}),null),a=((n=(n=(n=void 0!==e.value?h.find(t,function(e){return e.value==i.value}):n)||h.find(t,function(e){return e.node.hasNonDefaultValue()}))||t[0]).node.active=!0,e.value=n.value,i.formElement,"");return e.cls.selectWrapClass&&(a+='<div class="'+e.cls.selectWrapClass+'">'),a+='<select class="nav '+e.cls.textualInputClass+'"'+(i.disabled?" disabled":"")+">",h.each(t,function(e,t){a+='<option data-idx="'+t+'" value="'+e.value+'"'+(e.node.active?' selected="selected" class="active"':"")+">"+p(e.title)+"</option>"}),a+="</select>",e.cls.selectWrapClass&&(a+="</div>"),e.tabs=a,e},onInsert:function(e,n){f(n.el).find("select.nav").first().on("change",function(e){var t=f(this).find("option:selected");f(n.el).find('input[type="hidden"]').first().val(t.attr("value"))})}},optionfieldset:{template:'<div<% if (node.id) { %> id="<%= node.id %>"<% } %>><%= children %></div>'},section:{template:'<div<% if (node.id) { %> id="<%= node.id %>"<% } %> class="jsonform-node jsonform-error-<%= keydash %> <%= elt.htmlClass?elt.htmlClass:"" %>"><%= children %></div>'},questions:{template:'<div><input type="hidden" id="<%= node.id %>" name="<%= node.name %>" value="<%= escape(value) %>" /><%= children %></div>',fieldtemplate:!0,inputfield:!0,getElement:function(e){return f(e).parent().get(0)},onInsert:function(e,t){t.children&&0!==t.children.length&&(h.each(t.children,function(e){f(e.el).hide()}),f(t.children[0].el).show())}},question:{template:'<div id="<%= node.id %>"<% if (elt.optionsType === "radiobuttons") { %> class="<%= cls.buttonGroupClass %> btn-group-toggle" data-toggle="buttons"<% } %><% if (elt.inline) { %> class="<%= cls.formInlineClass %>"<% } %>><% _.each(node.options, function(key, val) { %><% if (elt.optionsType === "radiobuttons") { %><label class="btn <%= cls.buttonClass %><%= ((key instanceof Object && key.htmlClass) ? " " + key.htmlClass : "") %><%= (node.disabled || node.isReadOnly() ? " disabled" : "") %>"><input type="radio" style="position:absolute;left:-9999px;" name="<%= node.id %>" value="<%= val %>" <%= (node.disabled ? "disabled" : "") %>/><%= (key instanceof Object ? key.title : key) %></label> <% } else { %><div class="<% if (elt.inline) { %><%= cls.radioWrapInlineClass %><% } else { %><%= cls.radioWrapClass %><% } %>"><input class=\'<%= cls.radioInputClass %><%= ((key instanceof Object && key.htmlClass) ? " " + key.htmlClass : "") %>\' type="radio" id="<%= node.id %>_<%= escape(val) %>" value="<%= val %>" name="<%= node.id %>" <%= (node.disabled || node.isReadOnly() ? "disabled" : "") %>/><label class="<%= cls.radioLabelClass %>" for="<%= node.id %>_<%= escape(val) %>"><%= (key instanceof Object ? key.title : key) %></label></div><% } %><% }); %></div>',fieldtemplate:!0,onInsert:function(e,i){var l="active",t=i.formElement||{};t.activeClass?l+=" "+t.activeClass:"radiobuttons"===t.optionsType&&(l+=" "+i.ownerTree.defaultConfig.buttonClass),f(i.el).find('input[type="radio"]').on("change",function(e){var t,n=i.options[f(this).val()];i.parentNode&&i.parentNode.el&&(f(i.el).find("label").removeClass(l),f(i.el).find("label.btn").addClass(i.ownerTree.defaultConfig.buttonClass),f(this).closest("label.btn").removeClass(i.ownerTree.defaultConfig.buttonClass),f(this).closest("label").addClass(l),f(this).siblings("label").addClass(l),f(i.el).nextAll().hide(),f(i.el).nextAll().find('input[type="radio"]').prop("checked",!1),n.value&&f(i.parentNode.el).find('input[type="hidden"]').val(n.value),n.next&&(t=h.find(i.parentNode.children,function(e){return e.formElement&&e.formElement.qid===n.next}),f(t.el).show(),f(t.el).nextAll().hide(),f(t.el).nextAll().find('input[type="radio"]').prop("checked",!1)),n.href&&(n.target?window.open(n.href,n.target):window.location=n.href),n.submit&&setTimeout(function(){i.ownerTree.submit()},0))})}}},k.util.getObjKey=function(e,t,n){for(var i=e,l=t.split("."),a=null,s=null,o=null,r=0;r<l.length;r++){if(null===i||"object"!=typeof i)return null;if(o=(a=l[r]).replace(x,""),x.lastIndex=0,s=x.exec(a))for(;;){if(o&&!h.isArray(i[o]))return null;if(i=(o?i[o]:i)[parseInt(s[1])],!(s=x.exec(a)))break;o=null}else i=(n&&!i[o]&&h.isArray(i)&&i[0]?i[0]:i)[o]}return n&&h.isArray(i)&&i[0]?i[0]:i},k.util.getObjKeyEx=function(e,t,n){var i=e;if(null==t||""===t)return e;if("string"==typeof n&&0<n.length){if(t.slice(0,n.length)!==n)throw new Error("key ["+t+"] does not match the objKey ["+n+"]");"."===(t=t.slice(n.length))[0]&&(t=t.slice(1))}e=t.match(/^((([^\\\[.]|\\.)+)|\[(\d+)\])\.?(.*)$/);if(!e)throw new Error("bad format key: "+t);if("string"==typeof e[2]&&0<e[2].length)i=i[e[2]];else{if(!("string"==typeof e[4]&&0<e[4].length))throw new Error("impossible reach here");i=i[Number(e[4])]}return i=i&&0<e[5].length?this.getObjKeyEx(i,e[5]):i},k.util.setObjKey=function(e,t,n){for(var i=e,l=t.split("."),a=null,s=null,o=null,r=0;r<l.length-1;r++)if(o=(a=l[r]).replace(x,""),x.lastIndex=0,s=x.exec(a)){for(;;)if(h.isArray(i[o])||(i[o]=[]),i=i[o],o=parseInt(s[1],10),!(s=x.exec(a)))break;"object"==typeof i[o]&&null!==i[o]||(i[o]={}),i=i[o]}else"object"==typeof i[o]&&null!==i[o]||(i[o]={}),i=i[o];if(o=(a=l[l.length-1]).replace(x,""),x.lastIndex=0,s=x.exec(a)){for(;;)if(h.isArray(i[o])||(i[o]=[]),i=i[o],o=parseInt(s[1],10),!(s=x.exec(a)))break;i[o]=n}else i[o]=n},C.prototype.clone=function(e){var t=new C;return t.childPos=this.childPos,t.arrayPath=h.clone(this.arrayPath),t.ownerTree=this.ownerTree,t.parentNode=e||this.parentNode,t.formElement=this.formElement,t.schemaElement=this.schemaElement,t.view=this.view,t.children=h.map(this.children,function(e){return e.clone(t)}),t},C.prototype.hasNonDefaultValue=function(){return(!this.formElement||"hidden"!=this.formElement.type)&&(!(!this.value||this.defaultValue)||!!h.find(this.children,function(e){return e.hasNonDefaultValue()}))},C.prototype.getProperty=function(e,t){var n=this[e];return void 0===n&&t&&this.parentNode?this.parentNode.getProperty(e,!0):n},C.prototype.isReadOnly=function(){return this.getProperty("readOnly",!0)},C.prototype.getTitle=function(){var e=this.name;return this.title?e=this.title:this.name===this.key&&this.parentNode&&this.parentNode.key&&(e=e.substring(this.parentNode.key.length),this.parentNode.schemaElement&&this.parentNode.schemaElement.type&&("object"===this.parentNode.schemaElement.type?e=e.substring(1):"array"===this.parentNode.schemaElement.type&&(e=e.replace(/[\[\]']+/g,"")))),e},C.prototype.appendChild=function(e){return e.parentNode=this,e.childPos=this.children.length,this.children.push(e),e},C.prototype.removeChild=function(){var e=this.children[this.children.length-1];if(e)return f(e.el).remove(),this.children.pop()},C.prototype.moveValuesTo=function(e){var t=this.getFormValues(e.arrayPath);e.resetValues(),e.computeInitialValues(t,!0)},C.prototype.switchValuesWith=function(e){var t=this.getFormValues(e.arrayPath),n=e.getFormValues(this.arrayPath);e.resetValues(),e.computeInitialValues(t,!0),this.resetValues(),this.computeInitialValues(n,!0)},C.prototype.resetValues=function(){var e;if(this.value=null,this.parentNode?(this.arrayPath=h.clone(this.parentNode.arrayPath),this.parentNode.view&&this.parentNode.view.array&&this.arrayPath.push(this.childPos)):this.arrayPath=[],this.view&&this.view.inputfield)e=f(":input",this.el).serializeArray(),h.each(e,function(e){f('[name="'+g(e.name)+'"]',f(this.el)).val("")},this);else if(this.view&&this.view.array)for(;0<this.children.length;)this.removeChild();h.each(this.children,function(e){e.resetValues()})},C.prototype.setChildTemplate=function(e){(this.childTemplate=e).parentNode=this},C.prototype.getChildTemplate=function(){return this.childTemplate||this.view.array&&(key=this.formElement.items?this.formElement.items[0]||this.formElement.items:this.formElement.key+"[]",h.isString(key)&&(key={key:key}),this.setChildTemplate(this.ownerTree.buildFromLayout(key))),this.childTemplate},C.prototype.computeInitialValues=function(l,t,n){var a=this,e=null,i=1,s=0,o=this.ownerTree.formDesc.tpldata||{};if(n=n||0,this.parentNode?(this.arrayPath=h.clone(this.parentNode.arrayPath),this.parentNode.view&&this.parentNode.view.array&&this.arrayPath.push(this.childPos)):this.arrayPath=[],o.idx=0<this.arrayPath.length?this.arrayPath[this.arrayPath.length-1]+1:this.childPos+1,o.value="",o.getValue=function(e){if(!l)return"";for(var t=l,n=e.split("[]."),i=0;i<n.length-1;i++)t=t[n[i]][a.arrayPath[i]];return t[n[i]]},this.formElement&&(this.formElement.id?this.id=b(this.formElement.id,this.arrayPath):(this.view&&this.view.array||this.parentNode&&this.parentNode.view&&this.parentNode.view.array||"button"===this.formElement.type||"selectfieldset"===this.formElement.type||"question"===this.formElement.type||"buttonquestion"===this.formElement.type)&&(this.id=g(this.ownerTree.formDesc.prefix)+"-elt-counter-"+h.uniqueId()),this.formElement.key&&(this.key=b(this.formElement.key,this.arrayPath),this.keydash=d(this.key.replace(/\./g,"---"))),this.name=b(this.formElement.name,this.arrayPath),h.each(["title","legend","description","append","prepend","inlinetitle","helpvalue","value","disabled","required","placeholder","readOnly"],function(e){h.isString(this.formElement[e])?(-1!==this.formElement[e].indexOf("{{values.")?this[e]=this.formElement[e].replace(/\{\{values\.([^\}]+)\}\}/g,'{{getValue("$1")}}'):this[e]=b(this.formElement[e],this.arrayPath),this[e]&&(this[e]=h.template(this[e],E)(o))):this[e]=this.formElement[e]},this),this.formElement.options&&(this.options=h.map(this.formElement.options,function(e){var t=null;return h.isObject(e)&&e.title?(t=-1!==e.title.indexOf("{{values.")?e.title.replace(/\{\{values\.([^\}]+)\}\}/g,'{{getValue("$1")}}'):b(e.title,a.arrayPath),h.extend({},e,{value:u(e.value)?e.value:"",title:h.template(t,E)(o)})):e}))),this.view&&this.view.inputfield&&this.schemaElement)l?u(k.util.getObjKey(l,this.key))?this.value=k.util.getObjKey(l,this.key):u(this.schemaElement.default)&&(this.value=this.schemaElement.default,"string"==typeof this.value&&(this.value=h.template(this.value,E)(o))):t||u(this.value)||(r=y(a.ownerTree.formDesc.schema,this.key,n),u(r)&&(this.value=r,h.isString(this.value)&&(-1!==this.value.indexOf("{{values.")?this.value=this.value.replace(/\{\{values\.([^\}]+)\}\}/g,'{{getValue("$1")}}'):this.value=b(this.value,this.arrayPath,!0),this.value&&(this.value=h.template(this.value,E)(o))),this.defaultValue=!0));else if(this.view&&this.view.array){var r,i=0;for(l?(r=k.util.getObjKeyEx(l,this.key))&&Array.isArray(r)?i=r.length:h.isEmpty(r)||(i=this.getPreviousNumberOfItems(l,this.arrayPath)):t||(r=y(a.ownerTree.formDesc.schema,this.key,n))&&Array.isArray(r)&&(i=r.length),s=0;s<i;s++)this.appendChild(this.getChildTemplate().clone())}if(h.each(this.children,function(e){e.computeInitialValues(l,t,n)}),this.formElement&&this.formElement.valueInLegend)for(e=this;e;){if(e.parentNode&&e.parentNode.view&&e.parentNode.view.array&&(e.legendChild=this,e.formElement&&e.formElement.legend)){e.legend=b(e.formElement.legend,e.arrayPath),o.idx=0<e.arrayPath.length?e.arrayPath[e.arrayPath.length-1]+1:e.childPos+1,o.value=u(this.value)?this.value:"",e.legend=h.template(e.legend,E)(o);break}e=e.parentNode}},C.prototype.getPreviousNumberOfItems=function(t,n){var e,i=null;return t?this.view.inputfield&&this.schemaElement?(e=function(e,t){var n=0,i=0;if(!e)return null;if(0<t)for(;n<t;){if(-1===(i=e.indexOf("[]",i)))return e;i+=2,n+=1}return-1===(i=e.indexOf("[]",i))?e:e.substring(0,i)}(this.formElement.key,n.length),e=b(e,n),(e=k.util.getObjKey(t,e))?(i=h.map(this.children,function(e){return e.getPreviousNumberOfItems(t,n)}),h.max([h.max(i)||0,e.length])):0):this.view.array?this.getChildTemplate().getPreviousNumberOfItems(t,n):(i=h.map(this.children,function(e){return e.getPreviousNumberOfItems(t,n)}),h.max(i)||0):0},C.prototype.getFormValues=function(t){var e={};if(!this.el)throw new Error("formNode.getFormValues can only be called on nodes that are associated with a DOM element in the tree");var n=f(":input",this.el).serializeArray();n=(n=n.concat(f(":input[type=checkbox]:not(:disabled):not(:checked)[name]",this.el).map(function(){return{name:this.name,value:this.checked}}).get())).concat(f(':input[type=checkbox]:disabled[name][readonly="readonly"]',this.el).map(function(){return{name:this.name,value:this.checked}}).get()),t&&h.each(n,function(e){e.name=b(e.name,t)});for(var i=this.ownerTree.formDesc.schema,l=0;l<n.length;l++){var a,s,o=n[l].name,r=c(i.properties,o),d=null;if(r)if(r._jsonform_checkboxes_as_array&&(a=o.match(/\[([0-9]*)\]$/)))o=o.replace(/\[([0-9]*)\]$/,""),d=k.util.getObjKey(e,o)||[],"value"===r._jsonform_checkboxes_as_array&&!1!==n[l].value&&""!==n[l].value?d.push(n[l].value):!0===r._jsonform_checkboxes_as_array&&"1"===n[l].value&&d.push(r.enum[parseInt(a[1],10)]),k.util.setObjKey(e,o,d);else if("tagsinput"===r._jsonform_get_value_by_tagsinput)s=t?(a=b(o,this.arrayPath),f(':input[name="'+a+'"]',this.el).tagsinput("items")):f(':input[name="'+o+'"]',this.el).tagsinput("items"),k.util.setObjKey(e,o,s);else if("[]"===o.slice(-2)&&(o=o.slice(0,-2),"array"===(r=c(i.properties,o)).type))(d=k.util.getObjKey(e,o)||[]).push(n[l].value),k.util.setObjKey(e,o,d);else{if("boolean"===r.type&&("0"===n[l].value||"false"===n[l].value?n[l].value=!1:""===n[l].value?n[l].value=null:n[l].value=!!n[l].value),"number"!==r.type&&"integer"!==r.type||h.isString(n[l].value)&&(n[l].value.length?isNaN(Number(n[l].value))||(n[l].value=Number(n[l].value)):n[l].value=null),"string"!==r.type||""!==n[l].value||r._jsonform_allowEmpty||(n[l].value=null),"object"===r.type&&h.isString(n[l].value)&&"{"===n[l].value.substring(0,1))try{n[l].value=m.parse(n[l].value)}catch(e){n[l].value={}}if("array"===r.type&&h.isString(n[l].value))if("["===n[l].value.substring(0,1))try{n[l].value=m.parse(n[l].value)}catch(e){n[l].value=[]}else n[l].value=null;"null"===r.type&&"null"===n[l].value&&(n[l].value=null),"object"!==r.type||"null"!==n[l].value&&""!==n[l].value||(n[l].value=null),n[l].name&&(null!==n[l].value||"null"===r.type&&null===n[l].value)&&k.util.setObjKey(e,n[l].name,n[l].value)}}return e},C.prototype.render=function(e){var t=this.generate();this.setContent(t,e),this.enhance()},C.prototype.setContent=function(e,t){var n,e=f(e),t=t||(this.parentNode?this.parentNode.el:this.ownerTree.domRoot);this.el?f(this.el).replaceWith(e):(n=f(t).children().get(this.childPos))?f(n).before(e):f(t).append(e),this.el=e,this.updateElement(this.el)},C.prototype.updateElement=function(e){this.id&&(this.el=f("#"+g(this.id),e).get(0),this.view&&this.view.getElement&&(this.el=this.view.getElement(this.el)),!1!==this.fieldtemplate&&this.view&&this.view.fieldtemplate&&(this.el=f(this.el).parent().parent(),(this.prepend||this.append)&&(this.el=this.el.parent()),this.el=this.el.get(0)),this.parentNode&&this.parentNode.view&&this.parentNode.view.childTemplate&&(this.el=f(this.el).parent().get(0)));for(const t in this.children)0!=this.children.hasOwnProperty(t)&&this.children[t].updateElement(this.el||e)},C.prototype.generate=function(){var e={id:this.id,keydash:this.keydash,elt:this.formElement,schema:this.schemaElement,node:this,value:u(this.value)?this.value:"",cls:this.ownerTree.defaultConfig,escape:p},t=null,n=(this.ownerTree.formDesc.onBeforeRender&&this.ownerTree.formDesc.onBeforeRender(e,this),this.view.onBeforeRender&&this.view.onBeforeRender(e,this),t=this.template||(this.formElement&&this.formElement.template?this.formElement:this.view).template,!1!==this.fieldtemplate&&(this.fieldtemplate||this.view.fieldtemplate)&&(t=k.fieldTemplate(t)),this.parentNode&&this.parentNode.view&&this.parentNode.view.childTemplate&&(t=this.parentNode.view.childTemplate(t,this.parentNode)),"");return h.each(this.children,function(e){n+=e.generate()}),e.children=n,e.fieldHtmlClass="",this.ownerTree&&this.ownerTree.formDesc&&this.ownerTree.formDesc.params&&this.ownerTree.formDesc.params.fieldHtmlClass&&(e.fieldHtmlClass=this.ownerTree.formDesc.params.fieldHtmlClass),this.formElement&&void 0!==this.formElement.fieldHtmlClass&&(e.fieldHtmlClass=this.formElement.fieldHtmlClass),h.template(t,w)(e)},C.prototype.enhance=function(){var e,n=this,t=null,i=h.clone(this.ownerTree.formDesc.tpldata)||{};this.formElement&&(this.view.onInsert&&this.view.onInsert({target:f(this.el)},this),e=this.handlers||this.formElement.handlers,(t=this.onInsert||this.formElement.onInsert)&&t({target:f(this.el)},this),e&&h.each(e,function(e,t){"insert"===t&&e({target:f(this.el)},this)},this),this.el&&(this.onChange&&f(this.el).on("change",function(e){n.onChange(e,n)}),this.view.onChange&&f(this.el).on("change",function(e){n.view.onChange(e,n)}),this.formElement.onChange&&f(this.el).on("change",function(e){n.formElement.onChange(e,n)}),this.onInput&&f(this.el).on("input",function(e){n.onInput(e,n)}),this.view.onInput&&f(this.el).on("input",function(e){n.view.onInput(e,n)}),this.formElement.onInput&&f(this.el).on("input",function(e){n.formElement.onInput(e,n)}),this.onClick&&f(this.el).on("click",function(e){n.onClick(e,n)}),this.view.onClick&&f(this.el).on("click",function(e){n.view.onClick(e,n)}),this.formElement.onClick&&f(this.el).on("click",function(e){n.formElement.onClick(e,n)}),this.onKeyUp&&f(this.el).on("keyup",function(e){n.onKeyUp(e,n)}),this.view.onKeyUp&&f(this.el).on("keyup",function(e){n.view.onKeyUp(e,n)}),this.formElement.onKeyUp&&f(this.el).on("keyup",function(e){n.formElement.onKeyUp(e,n)}),e&&h.each(e,function(t,e){"insert"!==e&&f(this.el).on(e,function(e){t(e,n)})},this)),this.formElement.legend&&this.legendChild&&this.legendChild.formElement&&(t=function(e){n.formElement&&n.formElement.legend&&n.parentNode&&(n.legend=b(n.formElement.legend,n.arrayPath),i.idx=0<n.arrayPath.length?n.arrayPath[n.arrayPath.length-1]+1:n.childPos+1,i.value=f(e.target).val(),n.legend=h.template(n.legend,E)(i),f(n.parentNode.el).trigger("legendUpdated"))},f(this.legendChild.el).on("change",t),f(this.legendChild.el).on("keyup",t))),h.each(this.children,function(e){e.enhance()})},C.prototype.insertArrayItem=function(e,t){var n=0,i=(void 0===e&&(e=this.children.length),this.getChildTemplate().clone());for(this.appendChild(i),i.resetValues(),n=this.children.length-2;e<=n;n--)this.children[n].moveValuesTo(this.children[n+1]);for(this.children[e].resetValues(),this.children[e].computeInitialValues(null,!1,this.children[e].arrayPath.length),n=e;n<this.children.length;n++)this.children[n].render(t)},C.prototype.deleteArrayItem=function(e){for(var t=0,t=e=void 0===e?this.children.length-1:e;t<this.children.length-1;t++)this.children[t+1].moveValuesTo(this.children[t]),this.children[t].render();this.removeChild()},C.prototype.getArrayBoundaries=function(){if(!this.view||!this.view.array)return{minItems:-1,maxItems:-1};function l(e,t){var n=null,i={minItems:-1,maxItems:-1};return t=t||e,e.view&&e.view.array&&e!==t?i:e.key?(n=e.key.replace(/\[[0-9]+\]/g,"[]"),e!==t&&(n=n.replace(/\[\][^\[\]]*$/,"")),(n=c(e.ownerTree.formDesc.schema.properties,n))&&(0<=n.minItems&&(i.minItems=n.minItems),0<=n.minLength&&(i.minItems=n.minLength),0<=n.maxItems&&(i.maxItems=n.maxItems),0<=n.maxLength&&(i.maxItems=n.maxLength)),i):(h.each(e.children,function(e){e=l(e,t);-1!==e.minItems&&(-1!==i.minItems?i.minItems=Math.max(i.minItems,e.minItems):i.minItems=e.minItems),-1!==e.maxItems&&(-1!==i.maxItems?i.maxItems=Math.min(i.maxItems,e.maxItems):i.maxItems=e.maxItems)}),i)}return l(this)};a.prototype.initialize=function(e){this.formDesc=h.clone(e=e||{}),k.defaultConfig=i(),this.defaultConfig=h.clone(k.defaultConfig),this.formDesc.defaultConfig&&h.extend(this.defaultConfig,this.formDesc.defaultConfig),this.formDesc.prefix=this.formDesc.prefix||"jsonform-"+h.uniqueId();function c(e,t){Array.isArray(e)||(e=[e]);for(var n=!!t,i=[],l=0;l<e.length;l++){var a=e[l];"object"==typeof a?(i.push(a),n=!0):i.push({type:a})}return n&&i}this.formDesc.schema&&!0===function(e){if(e.type&&(h.isString(e.type)||Array.isArray(e.type)))return!1;var t,n=["$schema","properties","definitions"];for(t in e)if(h.contains(n,t))return!1;return!0}(this.formDesc.schema)&&(this.formDesc.schema={type:"object",properties:this.formDesc.schema}),this.formDesc._originalSchema=this.formDesc.schema,this.formDesc.schema=m.parse(m.stringify(this.formDesc.schema)),function e(t){if(t){var n,i;if(t.type&&("string"!=typeof t.type?(n=c(t.type))&&(t.anyOf=n,delete t.type):"any"==t.type&&delete t.type),t.extends&&(n=t.extends,Array.isArray(n)||(n=[n]),t.allOf=n,delete t.extends),t.disallow&&("string"==typeof t.disallow?t.not={type:t.disallow}:t.not={anyOf:c(t.disallow,!0)},delete t.disallow),t.properties){var l,a=Array.isArray(t.required)?t.required:[];for(l in t.properties){var s=t.properties[l];if(s&&"boolean"==typeof s.required)s.required&&a.indexOf(l)<0&&a.push(l),delete s.required;else if(void 0!==s.required&&"boolean"!=typeof s.required&&!Array.isArray(s.required))throw new Error("field "+l+"'s required property should be either boolean or array of strings");if("array"===s.type&&s.items&&Array.isArray(s.items))throw new Error("the items property of array property "+l+" in the schema definition must be an object")}a.length&&(t.required=a)}if(t.dependencies)for(var o in t.dependencies)"string"==typeof t.dependencies[o]&&(t.dependencies[o]=[t.dependencies[o]]);for(i in"boolean"==typeof t.required&&delete t.required,void 0!==t.divisibleBy&&(t.multipleOf=t.divisibleBy,delete t.divisibleBy),t)if("properties"===i||"patternProperties"===i||"dependencies"===i)for(var r in t[i])t[i][r]=e(t[i][r]);else if("enum"!==i)if(Array.isArray(t[i]))for(var d=0;d<t[i].length;d++)t[i][d]=e(t[i][d]);else"object"==typeof t[i]&&(t[i]=e(t[i]));return t}}(this.formDesc.schema),this.formDesc._originalSchemaV4=this.formDesc.schema,this.formDesc.schema=m.parse(m.stringify(this.formDesc.schema)),this.formDesc._originalSchemaV4.$schema&&delete this.formDesc._originalSchemaV4.$schema;var r=[],d=0;this.formDesc.schema.definitions&&!function a(s,o){Object.keys(s).forEach(function(e,t,n){var i,l=s[e];if(0===d&&"$ref"===e&&null!==l&&"string"==typeof l){if("#/definitions/"!==l.slice(0,14))throw new Error("Unresolved $ref: "+l);i=l.replace(/^#\/definitions\//,""),delete(s=h.extend(s,o[i])).$ref,r.indexOf(s)<0&&r.push(s)}else if(null!==l&&"object"==typeof l)if(l.$ref){if("#/definitions/"!==l.$ref.slice(0,14))throw new Error("Unresolved $ref: "+l.$ref);i=l.$ref.replace(/^#\/definitions\//,""),s[e]=h.extend(s[e],o[i]),delete s[e].$ref}else r.indexOf(l)<0&&(d+=1,a(l,o),--d,r.push(l))})}(this.formDesc.schema,this.formDesc.schema.definitions);if(this.formDesc.schema&&!0===function(e){if(e.type){if(h.isString(e.type)&&"object"===e.type)return!1;if(Array.isArray(e.type)&&h.contains(e.type,"object"))return!1}else if(e.properties)return!1;return!0}(this.formDesc.schema)){var t,n={},e=this.formDesc.prefix+"-distortedSchema";for(t in this.formDesc.schema)h.contains(["$schema","definitions"],t)||(n[t]=this.formDesc.schema[t],delete this.formDesc.schema[t]);this.formDesc.schema.properties={},this.formDesc.schema.properties[e]=n,this.formDesc._isDistorted=!0,!this.formDesc.value||"object"==typeof this.formDesc.value&&!Array.isArray(this.formDesc.value)||(this.formDesc.value={[e]:this.formDesc.value})}else this.formDesc._isDistorted=!1;this.formDesc.form=this.formDesc.form||["*",{type:"actions",items:[{type:"submit",value:"Submit"}]}],this.formDesc.form=h.isArray(this.formDesc.form)?this.formDesc.form:[this.formDesc.form],this.formDesc.params=this.formDesc.params||{},this.root=new C,(this.root.ownerTree=this).root.view=k.elementTypes.root,this.buildTree(),this.computeInitialValues()},a.prototype.buildTree=function(){h.each(this.formDesc.form,function(e){"*"===e?h.each(this.formDesc.schema.properties,function(e,t){this.formDesc.nonDefaultFormItems&&0<=this.formDesc.nonDefaultFormItems.indexOf(t)||this.root.appendChild(this.buildFromLayout({key:t}))},this):(h.isString(e)&&(e={key:e}),this.root.appendChild(this.buildFromLayout(e)))},this)},a.prototype.buildFromLayout=function(n,e){var t=null,i=new C;if(n.key&&this.formDesc.customFormItems&&(void 0!==(s=this.formDesc.customFormItems[n.key])&&(s.key=n.key,n=s)),(n=h.clone(n)).items&&(h.isArray(n.items)?n.items=h.map(n.items,h.clone):n.items=[h.clone(n.items)]),n.key){if(!(t=c(this.formDesc.schema.properties,n.key)))throw new Error('The JSONForm object references the schema key "'+n.key+'" but that key does not exist in the JSON schema');this.formDesc.onElementSchema&&this.formDesc.onElementSchema(n,t),n.name=n.name||n.key,n.title=n.title||t.title,n.description=n.description||t.description,n.readOnly=n.readOnly||t.readOnly||n.readonly||t.readonly;var l=function(e,t){var e=e.split("."),n=e.pop();if("[]"==n.slice(-2))return!1;var i,e=e.join(".");return e?(i=c(t.properties,e)).required&&0<=i.required.indexOf(n)&&("[]"==e.slice(-2)||l(e,t)):t.required&&0<=t.required.indexOf(n)};if(n.required=!0===n.required||!0===t.required||l(n.key,this.formDesc.schema),n.id||(n.id=g(this.formDesc.prefix)+"-elt-"+d(n.key)),n.allowEmpty&&(t._jsonform_allowEmpty=!0),!n.type){if(h.isArray(t.type)){if(h.contains(t.type,"null")&&(t.type=h.without(t.type,"null"),t.required=!1),1<t.type.length)throw new Error("Cannot process schema element with multiple types.");t.type=h.first(t.type)}"string"===t.type&&!h.isUndefined(t.format)&&h.contains(["url","time","email","date-time","date","color"],t.format)?"date-time"===t.format?n.type="datetime-local":n.type=t.format:"number"!==t.type&&"integer"!==t.type||t.enum?"string"!==t.type&&"any"!==t.type||t.enum?"boolean"===t.type?n.type="checkbox":"object"===t.type?t.properties?n.type="fieldset":n.type="textarea":h.isUndefined(t.enum)?n.type=t.type:n.type="select":n.type="text":n.type="number"}function a(n,e){n.options?Array.isArray(n.options)?n.options=n.options.map(function(e){return r(e,"value")?e:{value:e,title:e}}):"object"==typeof n.options&&(n.options=Object.keys(n.options).map(function(e){return{value:e,title:n.options[e]}})):n.titleMap?n.options=h.map(e,function(e){var t=e.toString();return{value:e,title:r(n.titleMap,t)?n.titleMap[t]:t}}):n.options=e.map(function(e){return{value:e,title:e.toString()}})}var s,o;n.options?a(n):!t.enum&&"boolean"!==t.type||((s=t.enum)?n.optionsAsEnumOrder=!0:s="select"===n.type?["",!0,!1]:[!0,!1],a(n,s)),"checkboxes"!==n.type&&"checkboxbuttons"!==n.type||!t.items||(s=Array.isArray(t.items)?t.items[0]:t.items,n.options?(a(n),s._jsonform_checkboxes_as_array="value"):(o=s.enum)&&(a(n,o),n.optionsAsEnumOrder=!0,s._jsonform_checkboxes_as_array="checkboxes"===n.type||"value")),"tagsinput"===n.getValue&&(t._jsonform_get_value_by_tagsinput="tagsinput"),"object"===t.type&&h.each(t.properties,function(e,t){t=n.key+"."+t;this.formDesc.nonDefaultFormItems&&0<=this.formDesc.nonDefaultFormItems.indexOf(t)||i.appendChild(this.buildFromLayout({key:t}))},this)}if(n.type||(n.type="text"),!(o=k.elementTypes[n.type]))throw new Error('The JSONForm contains an element whose type is unknown: "'+n.type+'"');if(t){if(!o.inputfield&&!o.array&&"selectfieldset"!==n.type&&"object"!==t.type)throw new Error('The JSONForm contains an element that links to an element in the JSON schema (key: "'+n.key+'") and that should not based on its type ("'+n.type+'")')}else if(o.inputfield&&"selectfieldset"!==n.type)throw new Error('The JSONForm defines an element of type "'+n.type+'" but no "key" property to link the input field to the JSON schema');return n.iddot=g(n.id||""),i.formElement=n,i.schemaElement=t,i.view=o,i.ownerTree=this,n.handlers||(n.handlers={}),i.view.array||(n.items?h.each(n.items,function(e){h.isString(e)&&(e={key:e}),i.appendChild(this.buildFromLayout(e))},this):n.otherField&&(s=n.otherField,h.isString(s)?s=n.otherField={key:s,notitle:!0}:void 0===s.notitle&&(s.notitle=!0),void 0===s.inline&&(s.inline=n.inline),i.appendChild(this.buildFromLayout(s)))),i},a.prototype.computeInitialValues=function(){this.root.computeInitialValues(this.formDesc.value)},a.prototype.render=function(e){e&&(this.domRoot=e,this.root.render(),this.hasRequiredField()&&f(e).addClass("jsonform-hasrequired"),f(e).addClass("jsonform"),f(e).attr("novalidate","novalidate"))},a.prototype.forEachElement=function(n){function i(e){for(var t=0;t<e.children.length;t++)n(e.children[t]),i(e.children[t])}i(this.root)},a.prototype.validate=function(e){var t,n,i,l=k.getFormValue(this.domRoot),a=!1,s=this.formDesc;return!1!==s.validate&&((t=!1)===this.domRoot.checkValidity()?(this.formDesc._validatorVendor="browser",t=!0):"object"!=typeof s.validate?o.Ajv?(t=new o.Ajv({allErrors:!0,schemaId:"auto",unknownFormats:"ignore",validateSchema:"log"}),this.formDesc._validatorVendor="ajv"):o.ZSchema?(t=new o.ZSchema({ignoreUnknownFormats:!0}),this.formDesc._validatorVendor="z-schema"):o.JSONFormValidator&&(t=o.JSONFormValidator.createEnvironment("json-schema-draft-03"),this.formDesc._validatorVendor="jsv"):t=s.validate,t&&(f(this.domRoot).jsonFormErrors(!1,s),"browser"==this.formDesc._validatorVendor?(n=[],Array.from(this.domRoot.elements).forEach(function(e){!1===e.checkValidity()&&e.id&&n.push({id:e.id,message:e.validationMessage||"Invalid value."})}),n.length&&(a=(a=a||[]).concat(n))):"ajv"==this.formDesc._validatorVendor?!(i=t.compile(this.formDesc._originalSchemaV4))(l)&&i.errors&&i.errors.length&&(a=i.errors):"z-schema"==this.formDesc._validatorVendor?(t.validate(l,this.formDesc._originalSchemaV4),a=t.getLastErrors(),0):"jsv"==this.formDesc._validatorVendor?(i=t.validate(l,this.formDesc._originalSchema))&&i.errors&&i.errors.length&&(a=(a=a||[]).concat(i.errors)):(i=t.validate(l,this.formDesc._originalSchema))&&i.errors&&i.errors.length&&(a=(a=a||[]).concat(i.errors)))),a&&!e&&(s.displayErrors?s.displayErrors(a,this.domRoot):f(this.domRoot).jsonFormErrors(a,s)),{errors:a,values:l}},a.prototype.submit=function(t){function e(){return t&&(t.preventDefault(),t.stopPropagation()),!1}var n=k.getFormValue(this.domRoot),i=this.formDesc,l=!1;if(this.forEachElement(function(e){l||e.view.onSubmit&&(l=!e.view.onSubmit(t,e))}),l)return e();var a=this.validate();return(i.onSubmit&&!i.onSubmit(a.errors,n)||a.errors||!(!i.onSubmitValid||i.onSubmitValid(n)))&&e()},a.prototype.hasRequiredField=function(){return 0<f(this.domRoot).find(".jsonform-required").length},k.getFormValue=function(e){e=f(e).data("jsonform-tree");if(!e)return null;var t=e.root.getFormValues();return t=e.formDesc._isDistorted?t[e.formDesc.prefix+"-distortedSchema"]:t},f.fn.jsonFormErrors=function(e,t){var n=f(this).data("jsonform-tree");if(f("."+n.defaultConfig.groupMarkClassPrefix+"error",this).removeClass(n.defaultConfig.groupMarkClassPrefix+"error"),f("."+n.defaultConfig.groupMarkClassPrefix+"warning",this).removeClass(n.defaultConfig.groupMarkClassPrefix+"warning"),f(".jsonform-errortext",this).hide(),!0===n.defaultConfig.bootstrapValidation&&this.addClass("was-validated"),e){for(var i,l,a,s,o=[],r=0;r<e.length;r++)"browser"===n.formDesc._validatorVendor?i=e[r].id:"ajv"===n.formDesc._validatorVendor?(i=e[r].dataPath||e[r].instancePath,0<=["dependencies","required","additionalProperties"].indexOf(e[r].keyword)&&e[r].params&&h.isObject(e[r].params)&&(i&&"/"!=i.slice(-1)&&(i+="/"),i+=e[r].params.missingProperty||e[r].params.property)):"z-schema"===n.formDesc._validatorVendor?(i=e[r].path,0<=["OBJECT_DEPENDENCY_KEY","OBJECT_MISSING_REQUIRED_PROPERTY"].indexOf(e[r].code)&&("/"!=i.slice(-1)&&(i+="/"),i+=e[r].params[0])):"jsv"===n.formDesc._validatorVendor?(i=e[r].uri,0<=["dependencies","required"].indexOf(e[r].attribute)&&("/"!=i.slice(-1)&&(i+="/"),e[r].details&&h.isObject(e[r].details)&&(a=Object.keys(e[r].details)[0],Array.isArray(e[r].details[a])?i+=e[r].details[a][0]:i+=a))):i=e[r].uri||e[r].path||e[r].dataPath,i&&(""===(i=(i="ajv"!==n.formDesc._validatorVendor||"."!==i.charAt(0)&&"/"!==i.charAt(0)?i:i.substring(1)).replace(/.*#\//,"").replace(/\//g,".").replace(/\.([0-9]+)(?=\.|$)/g,"[$1]"))&&n.formDesc._isDistorted&&(i=n.formDesc.prefix+"-distortedSchema"),"browser"===n.formDesc._validatorVendor?($node=f("#"+g(i),this).closest(".jsonform-node")).length&&(a=$node.attr("class").split(/\s+/).filter(function(e){return e.startsWith("jsonform-error-")}).shift())&&(l="."+g(a)):(l=".jsonform-error-"+g(i.replace(/\./g,"---")),$node=f(l,this)),o.push(l),s=e[r].type||"error","ajv"===n.formDesc._validatorVendor?0<=["minItems","maxItems"].indexOf(e[r].keyword)&&(0<=["checkboxes","checkboxbuttons"].indexOf($node.data("jsonform-type"))?e[r].message="Please select at "+("minItems"==e[r].keyword?"least":"most")+" "+e[r].params.limit+(1<e[r].params.limit?" options":" option")+".":0<=["tagsinput"].indexOf($node.data("jsonform-type"))&&(e[r].message="Please insert at "+("minItems"==e[r].keyword?"least":"most")+" "+e[r].params.limit+(1<e[r].params.limit?" tags":" tag")+".")):"z-schema"===n.formDesc._validatorVendor?"ARRAY_LENGTH_SHORT"!=e[r].code&&"ARRAY_LENGTH_LONG"!=e[r].code||(0<=["checkboxes","checkboxbuttons"].indexOf($node.data("jsonform-type"))?e[r].message="Please select at "+("ARRAY_LENGTH_SHORT"==e[r].code?"least":"most")+" "+e[r].params[1]+(1<e[r].params[1]?" options":" option")+".":0<=["tagsinput"].indexOf($node.data("jsonform-type"))&&(e[r].message="Please insert at "+("ARRAY_LENGTH_SHORT"==e[r].code?"least":"most")+" "+e[r].params[1]+(1<e[r].params[1]?" tags":" tag")+".")):"jsv"===n.formDesc._validatorVendor&&0<=["minItems","maxItems"].indexOf(e[r].attribute)&&(0<=["checkboxes","checkboxbuttons"].indexOf($node.data("jsonform-type"))?e[r].message="Please select at "+("minItems"==e[r].attribute?"least":"most")+" "+e[r].details+(1<e[r].details?" options":" option")+".":0<=["tagsinput"].indexOf($node.data("jsonform-type"))&&(e[r].message="Please insert at "+("minItems"==e[r].attribute?"least":"most")+" "+e[r].details+(1<e[r].details?" tags":" tag")+".")),$node.addClass(n.defaultConfig.groupMarkClassPrefix+s),$node.find("> div > .jsonform-errortext, > .jsonform-errortext").text(e[r].message).show());var o=o.join(","),d=f(o,this),c=d.parents(".tab-pane"),m=f(),c=(c.each(function(){var e=f(this);m=m.add(e.closest(".jsonform-tabbable").find("> .nav > li").eq(e.index()).addClass(n.defaultConfig.groupMarkClassPrefix+"error"))}),d.filter(":visible").get(0));(c=!c&&0<m.length?m.get(0):c)&&c.scrollIntoView&&c.scrollIntoView(!0,{behavior:"smooth"})}},f.fn.jsonForm=function(e,t){if("values"===e)return k.getFormValue(this);if("submit"===e||"validate"===e)return(n=this.data("jsonform-tree"))?"submit"===e?n.submit():n.validate(t):null;var n=this,i=(e=h.defaults({},e,{submitEvent:"submit"}),new a);return i.initialize(e),i.render(n.get(0)),n.data("jsonform-tree",i),e.submitEvent&&(n.off(e.submitEvent+".jsonform"),n.on(e.submitEvent+".jsonform",function(e){i.submit(e)})),l(n),f(".expandable > div, .expandable > fieldset",n).hide(),n.on("click",".expandable > legend",function(){var e=f(this).parent();e.toggleClass("expanded"),e.find("legend").attr("aria-expanded",e.hasClass("expanded")),f("> div",e).slideToggle(100)}),i.defaultConfig.useTooltip&&v(),i},f.fn.jsonFormValue=function(){return k.getFormValue(this)},o.JSONForm||(o.JSONForm=k)}("undefined"!=typeof exports,"undefined"!=typeof exports?exports:window,"undefined"!=typeof jQuery?jQuery:{fn:{}},"undefined"!=typeof _?_:null,JSON);